{% extends 'base.html' %}
{% block title %}Câmara Fria — MultiMax{% endblock %}
{% block content %}
<div class="mm-alert mm-alert-warning" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(245, 158, 11, 0.05)); border-left: 4px solid var(--mm-warning); border-radius: var(--mm-radius-lg); padding: var(--mm-space-4); margin-bottom: var(--mm-space-4); box-shadow: 0 2px 8px rgba(245, 158, 11, 0.2);">
    <i class="bi bi-exclamation-triangle-fill" style="font-size: 1.5rem; color: var(--mm-warning);"></i>
    <div style="flex: 1;">
        <strong style="display: block; margin-bottom: var(--mm-space-1); color: var(--mm-warning); font-size: var(--mm-text-lg);">⚠️ Página em Construção</strong>
        <span style="color: var(--mm-text-secondary);">Essa página está em construção e elaboração de raciocínio lógico e ainda não foi finalizada, logo, muitas coisas podem mudar</span>
    </div>
</div>
<div class="mm-page-header">
    <h1 class="mm-page-title">Ocupação da Câmara Fria</h1>
    <p class="mm-text-muted">Controle de capacidade e temperatura</p>
</div>

<div class="mm-grid mm-grid-cols-2 mm-gap-4 mm-mb-6">
    {% for ocup in ocupacoes %}
    <div class="mm-card">
        <h3 class="mm-card-title">{{ ocup.localizacao }}</h3>
        <div class="mm-mt-4">
            <div class="mm-mb-3">
                <div class="mm-flex mm-justify-between mm-mb-1">
                    <span>Ocupação</span>
                    <strong>{{ "%.1f"|format(ocup.percentual) }}%</strong>
                </div>
                <div class="mm-progress">
                    <div class="mm-progress-bar" style="width: {{ ocup.percentual }}%; 
                        background-color: {% if ocup.percentual > 90 %}var(--mm-danger){% elif ocup.percentual > 70 %}var(--mm-warning){% else %}var(--mm-success){% endif %};">
                    </div>
                </div>
            </div>
            <p><strong>Capacidade:</strong> {{ "%.2f"|format(ocup.capacidade_utilizada) }} / {{ "%.2f"|format(ocup.capacidade_total) }} kg</p>
            <p><strong>Temperatura:</strong> 
                {% if ocup.temperatura_atual %}
                    {% if ocup.temperatura_atual < ocup.temp_min or ocup.temperatura_atual > ocup.temp_max %}
                        <span style="color: var(--mm-danger);">{{ ocup.temperatura_atual }}°C ⚠️</span>
                    {% else %}
                        <span style="color: var(--mm-success);">{{ ocup.temperatura_atual }}°C</span>
                    {% endif %}
                {% else %}
                    -
                {% endif %}
            </p>
            <p><strong>Lotes:</strong> {{ ocup.lotes_count }}</p>
        </div>
    </div>
    {% endfor %}
</div>

{% if current_user.nivel != 'visualizador' %}
<div class="mm-card">
    <h3 class="mm-card-title">Registrar Ocupação</h3>
    <form method="POST" action="{{ url_for('camara_fria.registrar_ocupacao') }}" class="mm-mt-4">
        <div class="mm-grid mm-grid-cols-3 mm-gap-4">
            <div class="mm-form-group">
                <label>Localização *</label>
                <input type="text" name="localizacao" class="mm-form-control" required>
            </div>
            <div class="mm-form-group">
                <label>Capacidade Total (kg) *</label>
                <input type="number" name="capacidade_total" class="mm-form-control" step="0.01" min="0" required>
            </div>
            <div class="mm-form-group">
                <label>Temperatura Atual (°C)</label>
                <input type="number" name="temperatura" class="mm-form-control" step="0.1">
            </div>
        </div>
        <div class="mm-form-group">
            <label>Observação</label>
            <textarea name="observacao" class="mm-form-control" rows="2"></textarea>
        </div>
        <button type="submit" class="mm-btn mm-btn-primary">Registrar</button>
    </form>
</div>
{% endif %}
{% endblock %}

