{% extends 'base.html' %}
{% block title %}Relatório de Jornada — MultiMax{% endblock %}
{% block breadcrumb %}
<span class="mm-breadcrumb-separator">/</span>
<span>Relatório de Jornada</span>
{% endblock %}
{% block content %}
<div class="mm-page-header mm-flex mm-items-center mm-justify-between mm-mb-6">
    <div>
        <h1 class="mm-page-title">Relatório de Jornada</h1>
        <p class="mm-text-muted">Resumo e eventos no período selecionado</p>
    </div>
    <div class="mm-flex mm-gap-3">
        <a class="mm-btn mm-btn-outline" href="{{ url_for('jornada.index') }}"><i class="bi bi-arrow-left"></i> Voltar</a>
        <a class="mm-btn mm-btn-outline" href="{{ url_for('jornada.relatorio_export', collaborator_id=collab_id or '', inicio=inicio or '', fim=fim or '') }}"><i class="bi bi-file-earmark-excel"></i> Exportar Excel</a>
        <a class="mm-btn mm-btn-outline" href="{{ url_for('exportacao.exportar_jornada_pdf', collaborator_id=collab_id or '', inicio=inicio or '', fim=fim or '') }}"><i class="bi bi-file-earmark-pdf"></i> Exportar PDF</a>
    </div>
</div>

<div class="mm-card mm-mb-6">
    <div class="mm-card-header mm-flex mm-items-center mm-justify-between">
        <h3 class="mm-card-title"><i class="bi bi-funnel me-2"></i>Período</h3>
    </div>
    <div class="mm-card-body">
        <form class="mm-grid mm-grid-cols-3 mm-gap-4" method="get" action="/jornada/relatorio">
            <div>
                <label class="mm-label">Colaborador</label>
                <select name="collaborator_id" class="mm-input mm-select">
                    <option value="">— todos —</option>
                    {% for c in colaboradores %}
                    <option value="{{ c.id }}" {% if collab_id and collab_id == c.id %}selected{% endif %}>{{ c.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="mm-label">Início</label>
                <input type="date" name="inicio" value="{{ inicio or '' }}" class="mm-input">
            </div>
            <div>
                <label class="mm-label">Fim</label>
                <input type="date" name="fim" value="{{ fim or '' }}" class="mm-input">
            </div>
            <div class="mm-flex mm-items-end">
                <button class="mm-btn mm-btn-primary" type="submit"><i class="bi bi-search"></i> Atualizar</button>
            </div>
        </form>
    </div>
    <div class="mm-card-body">
        <div class="mm-table-wrapper">
            <table class="mm-table">
                <thead>
                    <tr>
                        <th>Colaborador</th>
                        <th style="text-align:right">Horas restantes</th>
                        <th style="text-align:right">Dias restantes</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in resumo %}
                    <tr>
                        <td>{{ r.name }}</td>
                        <td style="text-align:right">{{ '%.2f'|format(r.residual_hours or 0) }} h</td>
                        <td style="text-align:right">{{ r.saldo_days or 0 }} dia(s)</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="3" class="mm-empty-cell">
                            <div class="mm-empty-inline">
                                <i class="bi bi-clipboard-x"></i>
                                <span>Sem dados para o período</span>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="mm-card">
    <div class="mm-card-header mm-flex mm-items-center mm-justify-between">
        <h3 class="mm-card-title"><i class="bi bi-table me-2"></i>Eventos</h3>
        <span class="mm-badge">{{ eventos|length }} itens</span>
    </div>
    <div class="mm-card-body">
        <div class="mm-table-wrapper">
            <table class="mm-table">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Colaborador</th>
                        <th>Tipo</th>
                        <th style="text-align:right">Valor</th>
                        <th>Observações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for e in eventos %}
                    <tr>
                        <td>{{ e.date.strftime('%d/%m/%Y') }}</td>
                        <td>{{ e.collab_name }}</td>
                        <td>
                            {% if e.tipo == 'horas' %}Horas registradas{% elif e.tipo == 'dias_add' %}Dias acrescentados{% elif e.tipo == 'dias_uso' %}Dias usados{% elif e.tipo == 'dias_pago' %}Dias convertidos em R${% else %}{{ e.tipo }}{% endif %}
                        </td>
                        <td style="text-align:right">
                            {% if e.tipo == 'horas' %}{{ '%.2f'|format(e.valor or 0) }} h{% else %}{{ e.valor }} dia(s){% endif %}
                        </td>
                        <td>{{ e.descricao or '-' }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="mm-empty-cell">
                            <div class="mm-empty-inline">
                                <i class="bi bi-archive"></i>
                                <span>Sem eventos no período</span>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<style>
@media (max-width: 768px) {
  .mm-page-header { flex-direction: column; align-items: stretch; }
  .mm-page-header .mm-flex.mm-gap-3 { display: grid; grid-template-columns: 1fr 1fr; grid-auto-rows: auto; gap: var(--mm-space-2); margin-top: var(--mm-space-2); }
  .mm-page-header .mm-flex.mm-gap-3 a { width: 100%; }
  .mm-page-header .mm-flex.mm-gap-3 a:nth-child(3) { grid-column: 1 / -1; }
}
</style>
{% endblock %}
