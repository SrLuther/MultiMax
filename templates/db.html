{% extends 'base.html' %}
{% block title %}Banco de Dados — MultiMax{% endblock %}

{% block head %}
<!-- Meta tags para configuração do módulo DB Admin -->
<meta name="db-url-metrics" content="{{ url_for('dbadmin.metrics') }}">
<meta name="db-url-health" content="{{ url_for('dbadmin.health') }}">
<meta name="db-url-logs" content="{{ url_for('dbadmin.logs') }}">
<meta name="db-url-metrics-trends" content="{{ url_for('dbadmin.metrics_trends') }}">
<meta name="db-url-slow-queries" content="{{ url_for('dbadmin.slow_queries') }}">
<meta name="db-url-maintenance-stats" content="{{ url_for('dbadmin.maintenance_stats') }}">
<meta name="db-url-maintenance-recommendations" content="{{ url_for('dbadmin.maintenance_recommendations') }}">
<meta name="db-url-maintenance-history" content="{{ url_for('dbadmin.maintenance_history') }}">
<meta name="db-url-maintenance-cleanup" content="{{ url_for('dbadmin.maintenance_cleanup') }}">
<meta name="db-url-maintenance-optimize" content="{{ url_for('dbadmin.maintenance_optimize') }}">
<meta name="db-url-verify-backups" content="{{ url_for('dbadmin.verify_backups') }}">
<meta name="db-url-maintenance-run-all" content="{{ url_for('dbadmin.maintenance_run_all') }}">
<meta name="db-url-maintenance-export-report" content="{{ url_for('dbadmin.maintenance_export_report') }}">
<meta name="db-url-git-status" content="{{ url_for('dbadmin.git_status') }}">
<meta name="db-url-git-update" content="{{ url_for('dbadmin.git_update') }}">
{% endblock %}

{% block content %}
<div class="db-container">
    <!-- Hero Header -->
    <div class="db-hero">
        <div class="db-hero-content">
            <div>
                <h1 class="db-title">
                    <i class="bi bi-database db-title-icon"></i>
                    Banco de Dados
                </h1>
                <p class="db-subtitle">Painel Técnico de Desenvolvimento e Monitoramento</p>
            </div>
            <div class="db-hero-actions">
                <form method="post" action="{{ url_for('dbadmin.backup_now') }}">
                    <button type="submit" class="btn-action btn-action-primary">
                        <i class="bi bi-cloud-arrow-up"></i>
                        <span>Criar Backup</span>
                    </button>
                </form>
                {% if is_sqlite %}
                <form method="post" action="{{ url_for('dbadmin.restaurar_snapshot') }}" onsubmit="return confirm('Restaurar o último snapshot? Esta ação sobrescreve o banco atual.')">
                    <button type="submit" class="btn-action btn-action-secondary">
                        <i class="bi bi-arrow-counterclockwise"></i>
                        <span>Restaurar Snapshot</span>
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Info Box -->
    <div class="db-info-box-modern">
        <i class="bi bi-info-circle"></i>
        <div>
            <strong>Backups Automáticos</strong>
            <p>Backups automáticos a cada 15 minutos (mínimo). Mantém no máximo 20 mais recentes. Inclui backup-24h.sqlite atualizado diariamente às 00h.</p>
        </div>
    </div>

    {% if not is_sqlite %}
    <div class="db-alert-modern db-alert-warning">
        <i class="bi bi-exclamation-triangle"></i>
        <div>
            <strong>Atenção</strong>
            <p>Backup automático está disponível apenas quando o banco é SQLite.</p>
        </div>
    </div>
    {% endif %}

    <!-- Card de Monitoramento de Atualizações Git -->
    <div class="db-card-modern db-card-highlight" id="gitUpdateCard">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-git"></i>
                Monitoramento de Atualizações Git
            </h3>
            <div style="display: flex; gap: 0.5rem;">
                <button type="button" class="db-btn-modern db-btn-outline" data-action="refresh-git" data-force="false" id="refreshGitBtn">
                    <i class="bi bi-arrow-repeat"></i>
                    Atualizar
                </button>
                <button type="button" class="db-btn-modern db-btn-outline" data-action="refresh-git" data-force="true" id="forceCheckBtn" title="Força uma checagem completa do repositório remoto">
                    <i class="bi bi-arrow-repeat"></i>
                    Forçar Checagem
                </button>
            </div>
        </div>
        <div class="db-card-body-modern">
            <div class="db-git-info">
                <div class="db-git-repo-info">
                    <div class="db-git-repo-item">
                        <span class="db-git-label">Repositório:</span>
                        <a href="https://github.com/SrLuther/MultiMax" target="_blank" class="db-git-link">
                            https://github.com/SrLuther/MultiMax
                            <i class="bi bi-box-arrow-up-right"></i>
                        </a>
                    </div>
                    <div class="db-git-repo-item">
                        <span class="db-git-label">Branch:</span>
                        <span class="db-git-value">nova-versao-deploy</span>
                    </div>
                </div>
                
                <div class="db-git-status-grid" id="gitStatusGrid">
                    <div class="db-git-status-item">
                        <div class="db-git-status-label">Versão Local Atual</div>
                        <div class="db-git-status-value" id="currentVersion">Carregando...</div>
                        <small class="db-git-status-hint">Versão aplicada no servidor</small>
                    </div>
                    <div class="db-git-status-item">
                        <div class="db-git-status-label">Commit Local</div>
                        <div class="db-git-status-value" id="currentCommit">Carregando...</div>
                        <small class="db-git-status-hint">Commit atual do sistema</small>
                    </div>
                    <div class="db-git-status-item">
                        <div class="db-git-status-label">Último Commit Remoto</div>
                        <div class="db-git-status-value" id="latestCommit">Carregando...</div>
                        <small class="db-git-status-hint">Commit mais recente no GitHub</small>
                    </div>
                    <div class="db-git-status-item">
                        <div class="db-git-status-label">Mensagem do Commit</div>
                        <div class="db-git-status-value db-git-commit-message" id="commitMessage">Carregando...</div>
                        <small class="db-git-status-hint">Descrição da última alteração</small>
                    </div>
                </div>
                
                <div class="db-git-update-status" id="updateStatus">
                    <div class="db-git-update-indicator" id="updateIndicator">
                        <i class="bi bi-hourglass-split"></i>
                        <span>Verificando atualizações...</span>
                    </div>
                </div>
                
                <div class="db-git-actions" style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <button type="button" class="db-btn-modern db-btn-primary db-btn-lg" id="applyUpdateBtn" data-action="show-update-confirmation" data-force="false" disabled style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="bi bi-cloud-arrow-down"></i>
                            <span>Aplicar Atualização Completa</span>
                        </div>
                        <small style="font-size: 0.75rem; opacity: 0.8; font-weight: normal;">
                            Inclui rebuild do container
                        </small>
                    </button>
                    <button type="button" class="db-btn-modern db-btn-warning db-btn-lg" id="reinstallUpdateBtn" data-action="show-update-confirmation" data-force="true" style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="bi bi-arrow-clockwise"></i>
                            <span>Reinstalar Atualização</span>
                        </div>
                        <small style="font-size: 0.75rem; opacity: 0.8; font-weight: normal;">
                            Força atualização mesmo se já estiver atualizado
                        </small>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Monitoramento de CPU e Memória -->
    <div class="db-card-modern">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-cpu"></i>
                CPU e Memória
            </h3>
            <div class="db-card-badges">
                <span class="db-badge-modern db-badge-info" id="serverClock">Servidor — --:--:--</span>
                <span class="db-badge-modern db-badge-primary">Atualiza a cada 10s</span>
            </div>
        </div>
        <div class="db-card-body-modern">
            <div class="db-charts-grid">
                <div class="db-chart-card">
                    <div class="db-chart-header">
                        <div class="db-chart-label">
                            <i class="bi bi-cpu-fill"></i>
                            CPU (%)
                        </div>
                    </div>
                    <div class="db-chart-wrapper">
                        <canvas id="cpuChart"></canvas>
                    </div>
                </div>
                <div class="db-chart-card">
                    <div class="db-chart-header">
                        <div class="db-chart-label">
                            <i class="bi bi-memory"></i>
                            Memória (%)
                        </div>
                    </div>
                    <div class="db-chart-wrapper">
                        <canvas id="memChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="db-card-footer-modern">
            <i class="bi bi-server"></i>
            <span>Origem: host local do MultiMax</span>
        </div>
    </div>

    <!-- Health Checks -->
    <div class="db-card-modern">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-heart-pulse"></i>
                Monitoramento de Serviços
            </h3>
            <button type="button" class="db-btn-modern db-btn-outline" data-action="refresh-health-checks">
                <i class="bi bi-arrow-repeat"></i>
                Atualizar
            </button>
        </div>
        <div class="db-card-body-modern">
            <div class="db-health-grid" id="healthChecksGrid">
                <div class="db-logs-loading">Carregando monitoramento...</div>
            </div>
        </div>
        <div class="db-card-footer-modern">
            <i class="bi bi-clock"></i>
            <span>Última verificação: <span id="lastHealthCheck">Carregando...</span></span>
        </div>
    </div>

    <!-- Logs em Tempo Real -->
    <div class="db-card-modern">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-journal-text"></i>
                Logs em Tempo Real
            </h3>
            <div class="db-logs-controls">
                <select id="logTypeFilter" class="db-select-modern" data-action="update-logs">
                    <option value="all">Todos os tipos</option>
                    <option value="system">Sistema</option>
                    <option value="app">Aplicação</option>
                </select>
                <select id="logLevelFilter" class="db-select-modern" data-action="update-logs">
                    <option value="all">Todos os níveis</option>
                    <option value="ERROR">Erro</option>
                    <option value="WARNING">Aviso</option>
                    <option value="INFO">Info</option>
                </select>
                <button type="button" class="db-btn-modern db-btn-outline" id="pauseLogsBtn" data-action="toggle-logs-pause">
                    <i class="bi bi-pause-fill"></i>
                    Pausar
                </button>
                <button type="button" class="db-btn-modern db-btn-outline" data-action="clear-logs">
                    <i class="bi bi-trash"></i>
                    Limpar
                </button>
            </div>
        </div>
        <div class="db-card-body-modern">
            <div class="db-logs-container" id="logsContainer">
                <div class="db-logs-loading">Carregando logs...</div>
            </div>
        </div>
    </div>

    <!-- Análise de Tendências -->
    <div class="db-card-modern">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-graph-up"></i>
                Análise de Tendências
            </h3>
            <div class="db-trends-controls">
                <select id="trendMetricType" class="db-select-modern" onchange="updateTrends()">
                    <option value="cpu">CPU</option>
                    <option value="memory">Memória</option>
                    <option value="disk">Disco</option>
                    <option value="database_response_time">Tempo de Resposta DB</option>
                </select>
                <select id="trendHours" class="db-select-modern" onchange="updateTrends()">
                    <option value="6">Últimas 6 horas</option>
                    <option value="24" selected>Últimas 24 horas</option>
                    <option value="168">Última semana</option>
                </select>
            </div>
        </div>
        <div class="db-card-body-modern">
            <div class="db-trends-chart-wrapper">
                <canvas id="trendsChart"></canvas>
            </div>
            <div class="db-trends-stats" id="trendsStats">
                <!-- Preenchido via JavaScript -->
            </div>
        </div>
    </div>

    <!-- Monitoramento de Queries -->
    <div class="db-card-modern">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-code-square"></i>
                Queries Lentas do Banco
            </h3>
            <button type="button" class="db-btn-modern db-btn-outline" data-action="update-slow-queries">
                <i class="bi bi-arrow-repeat"></i>
                Atualizar
            </button>
        </div>
        <div class="db-card-body-modern">
            <div class="db-table-wrapper">
                <table class="db-table-modern">
                    <thead>
                        <tr>
                            <th>Data/Hora</th>
                            <th>Tempo (ms)</th>
                            <th>Endpoint</th>
                            <th>Query</th>
                        </tr>
                    </thead>
                    <tbody id="slowQueriesTableBody">
                        <tr><td colspan="4" class="text-center">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Manutenção e Otimização -->
    <div class="db-card-modern">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-tools"></i>
                Manutenção e Otimização
            </h3>
        </div>
        <div class="db-card-body-modern">
            <div class="db-maintenance-grid">
                <div class="db-maintenance-action">
                    <div class="db-maintenance-icon db-maintenance-cleanup">
                        <i class="bi bi-broom"></i>
                    </div>
                    <div class="db-maintenance-content">
                        <h4>Limpeza de Logs</h4>
                        <p>Remove logs antigos (mais de 30 dias) para liberar espaço</p>
                        <button type="button" class="db-btn-modern db-btn-outline" onclick="runMaintenanceCleanup()">
                            <i class="bi bi-play-fill"></i>
                            Executar Limpeza
                        </button>
                    </div>
                </div>
                <div class="db-maintenance-action">
                    <div class="db-maintenance-icon db-maintenance-optimize">
                        <i class="bi bi-lightning-fill"></i>
                    </div>
                    <div class="db-maintenance-content">
                        <h4>Otimizar Banco</h4>
                        <p>Executa VACUUM e ANALYZE para otimizar o banco de dados</p>
                        <button type="button" class="db-btn-modern db-btn-outline" onclick="runMaintenanceOptimize()">
                            <i class="bi bi-play-fill"></i>
                            Otimizar Agora
                        </button>
                    </div>
                </div>
                <div class="db-maintenance-action">
                    <div class="db-maintenance-icon db-maintenance-verify">
                        <i class="bi bi-shield-check"></i>
                    </div>
                    <div class="db-maintenance-content">
                        <h4>Verificar Backups</h4>
                        <p>Verifica integridade de todos os backups</p>
                        <button type="button" class="db-btn-modern db-btn-outline" onclick="verifyAllBackups()">
                            <i class="bi bi-play-fill"></i>
                            Verificar Backups
                        </button>
                    </div>
                </div>
            </div>
            <div class="db-maintenance-history">
                <h4>Histórico de Manutenção</h4>
                <div class="db-table-wrapper">
                    <table class="db-table-modern">
                        <thead>
                            <tr>
                                <th>Data/Hora</th>
                                <th>Tipo</th>
                                <th>Status</th>
                                <th>Duração</th>
                                <th>Itens Processados</th>
                            </tr>
                        </thead>
                        <tbody id="maintenanceHistoryBody">
                            <tr><td colspan="5" class="text-center">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Diagnóstico Completo -->
    <div class="db-card-modern" id="problems_and_diagnostics">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-activity"></i>
                Diagnóstico Completo
            </h3>
            <button type="button" class="db-btn-modern db-btn-outline" data-action="reload-diag">
                <i class="bi bi-arrow-repeat"></i>
                Recarregar
            </button>
        </div>
        <div class="db-card-body-modern db-iframe-wrapper">
            <iframe id="dbStatusFrame" src="{{ url_for('_dbstatus') }}" class="db-iframe-modern"></iframe>
        </div>
    </div>

    <!-- Backup Diário -->
    {% if daily_backup %}
    <div class="db-card-modern db-card-highlight db-card-success">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-calendar-check"></i>
                Backup Diário (24h)
            </h3>
            <span class="db-badge-modern db-badge-success">
                <i class="bi bi-clock-history"></i>
                Atualizado diariamente às 00h
            </span>
        </div>
        <div class="db-card-body-modern">
            <div class="db-stats-grid">
                <div class="db-stat-item-modern">
                    <div class="db-stat-icon-modern db-stat-icon-file">
                        <i class="bi bi-file-earmark-zip"></i>
                    </div>
                    <div class="db-stat-content-modern">
                        <div class="db-stat-label-modern">Arquivo</div>
                        <div class="db-stat-value-modern">{{ daily_backup.name }}</div>
                    </div>
                </div>
                <div class="db-stat-item-modern">
                    <div class="db-stat-icon-modern db-stat-icon-size">
                        <i class="bi bi-hdd"></i>
                    </div>
                    <div class="db-stat-content-modern">
                        <div class="db-stat-label-modern">Tamanho</div>
                        <div class="db-stat-value-modern">{{ '%.2f'|format((daily_backup.size or 0)/1024/1024) }} MB</div>
                    </div>
                </div>
                <div class="db-stat-item-modern">
                    <div class="db-stat-icon-modern db-stat-icon-time">
                        <i class="bi bi-clock"></i>
                    </div>
                    <div class="db-stat-content-modern">
                        <div class="db-stat-label-modern">Última atualização</div>
                        <div class="db-stat-value-modern">{{ daily_backup.mtime_str }}</div>
                    </div>
                </div>
            </div>
            <div class="db-download-action">
                <a class="db-btn-modern db-btn-success" href="{{ url_for('dbadmin.download', name=daily_backup.name) }}">
                    <i class="bi bi-download"></i>
                    Baixar Backup 24h
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Backups Recentes -->
    <div class="db-card-modern">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-archive"></i>
                Backups Recentes
            </h3>
            <a class="db-btn-modern db-btn-outline" href="{{ url_for('dbadmin.index') }}">
                <i class="bi bi-arrow-repeat"></i>
                Atualizar
            </a>
        </div>
        <div class="db-card-body-modern">
            {% if backups %}
            <div class="db-table-wrapper">
                <table class="db-table-modern">
                    <thead>
                        <tr>
                            <th>Arquivo</th>
                            <th class="text-right">Tamanho</th>
                            <th>Modificado</th>
                            <th class="text-center">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for it in backups %}
                        <tr class="db-table-row">
                            <td>
                                <div class="db-file-info">
                                    <div class="db-file-icon">
                                        <i class="bi bi-file-earmark-zip"></i>
                                    </div>
                                    <div class="db-file-name">{{ it.name }}</div>
                                </div>
                            </td>
                            <td class="text-right">
                                <span class="db-badge-modern db-badge-info">{{ '%.2f'|format((it.size or 0)/1024/1024) }} MB</span>
                            </td>
                            <td class="db-table-date">
                                <i class="bi bi-calendar3"></i>
                                {{ it.mtime_str }}
                            </td>
                            <td>
                                <div class="db-actions-modern">
                                    <a class="db-btn-action-small db-btn-view" href="{{ url_for('dbadmin.download', name=it.name) }}" title="Baixar">
                                        <i class="bi bi-download"></i>
                                    </a>
                                    {% if is_sqlite %}
                                    <form method="post" action="{{ url_for('dbadmin.restaurar', name=it.name) }}" onsubmit="return confirm('Restaurar este backup? Esta ação sobrescreve o banco atual.')" style="display: inline;">
                                        <button class="db-btn-action-small db-btn-restore" type="submit" title="Restaurar">
                                            <i class="bi bi-arrow-counterclockwise"></i>
                                        </button>
                                    </form>
                                    {% endif %}
                                    <form method="post" action="{{ url_for('dbadmin.excluir', name=it.name) }}" onsubmit="return confirm('Excluir backup {{ it.name }}?')" style="display: inline;">
                                        <button class="db-btn-action-small db-btn-delete" type="submit" title="Excluir">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="db-pagination-modern">
                <span class="db-pagination-info">Página {{ page }} de {{ total_pages }}</span>
                <div class="db-pagination-btns">
                    <a class="db-btn-pagination {% if page <= 1 %}db-disabled{% endif %}" href="{{ url_for('dbadmin.index') }}?page={{ page-1 if page>1 else 1 }}">
                        <i class="bi bi-chevron-left"></i>
                        Anterior
                    </a>
                    <a class="db-btn-pagination {% if page >= total_pages %}db-disabled{% endif %}" href="{{ url_for('dbadmin.index') }}?page={{ page+1 if page<total_pages else total_pages }}">
                        Próximo
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </div>
            </div>
            {% else %}
            <div class="db-empty-state-large">
                <i class="bi bi-archive"></i>
                <h3>Nenhum backup disponível</h3>
                <p>Nenhum backup foi criado ainda. Use o botão "Criar Backup" para criar o primeiro backup.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Histórico de Conexões -->
    <div class="db-card-modern">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-person-check"></i>
                Histórico de Conexões
            </h3>
            <span class="db-badge-modern db-badge-info">Últimos logins</span>
        </div>
        <div class="db-card-body-modern">
            {% if logins %}
            <div class="db-table-wrapper">
                <table class="db-table-modern">
                    <thead>
                        <tr>
                            <th>Usuário</th>
                            <th>IP</th>
                            <th>Navegador</th>
                            <th>Data/Hora</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for login in logins %}
                        <tr class="db-table-row">
                            <td>
                                <div class="db-user-info">
                                    <div class="db-user-avatar">
                                        {{ (login.username or '?')[:2].upper() }}
                                    </div>
                                    <div class="db-user-name">{{ login.username or '-' }}</div>
                                </div>
                            </td>
                            <td>
                                <code class="db-code-modern">{{ login.ip_address or '-' }}</code>
                            </td>
                            <td class="db-user-agent">
                                <span class="db-text-truncate">{{ (login.user_agent or '-')[:50] }}{% if login.user_agent and login.user_agent|length > 50 %}...{% endif %}</span>
                            </td>
                            <td class="db-table-date">
                                <i class="bi bi-calendar3"></i>
                                {{ login.login_at.strftime('%d/%m/%Y %H:%M') if login.login_at else '-' }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if logins_pag %}
            <div class="db-pagination-modern">
                <span class="db-pagination-info">Página {{ logins_pag.page }} de {{ logins_pag.pages or 1 }}</span>
                <div class="db-pagination-btns">
                    <a class="db-btn-pagination {% if not logins_pag.has_prev %}db-disabled{% endif %}" href="{{ url_for('dbadmin.index') }}?login_page={{ logins_pag.prev_num or 1 }}">
                        <i class="bi bi-chevron-left"></i>
                        Anterior
                    </a>
                    <a class="db-btn-pagination {% if not logins_pag.has_next %}db-disabled{% endif %}" href="{{ url_for('dbadmin.index') }}?login_page={{ logins_pag.next_num or logins_pag.pages or 1 }}">
                        Próximo
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </div>
            </div>
            {% endif %}
            {% else %}
            <div class="db-empty-state-large">
                <i class="bi bi-person-x"></i>
                <h3>Nenhum registro de login</h3>
                <p>Nenhum registro de login foi encontrado ainda.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/db.js') }}"></script>
<script>
// Event listeners para data-attributes
document.addEventListener('DOMContentLoaded', function() {
    // Botões com data-action
    document.querySelectorAll('[data-action]').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const action = this.getAttribute('data-action');
            const force = this.getAttribute('data-force') === 'true';
            
            switch(action) {
                case 'refresh-git':
                    if (window.dbAdmin && window.dbAdmin.refreshGitStatus) {
                        window.dbAdmin.refreshGitStatus(force);
                    }
                    break;
                case 'show-update-confirmation':
                    if (window.dbAdmin && window.dbAdmin.showUpdateConfirmation) {
                        window.dbAdmin.showUpdateConfirmation(force);
                    }
                    break;
                case 'refresh-health-checks':
                    if (window.dbAdmin && window.dbAdmin.refreshHealthChecks) {
                        window.dbAdmin.refreshHealthChecks();
                    }
                    break;
                case 'toggle-logs-pause':
                    if (window.dbAdmin && window.dbAdmin.toggleLogsPause) {
                        window.dbAdmin.toggleLogsPause();
                    }
                    break;
                case 'clear-logs':
                    if (window.dbAdmin && window.dbAdmin.clearLogs) {
                        window.dbAdmin.clearLogs();
                    }
                    break;
                case 'update-slow-queries':
                    if (window.dbAdmin && window.dbAdmin.updateSlowQueries) {
                        window.dbAdmin.updateSlowQueries();
                    }
                    break;
                case 'run-maintenance-cleanup':
                    if (window.dbAdmin && window.dbAdmin.runMaintenanceCleanup) {
                        window.dbAdmin.runMaintenanceCleanup();
                    }
                    break;
                case 'run-maintenance-optimize':
                    if (window.dbAdmin && window.dbAdmin.runMaintenanceOptimize) {
                        window.dbAdmin.runMaintenanceOptimize();
                    }
                    break;
                case 'verify-all-backups':
                    if (window.dbAdmin && window.dbAdmin.verifyAllBackups) {
                        window.dbAdmin.verifyAllBackups();
                    }
                    break;
                case 'reload-diag':
                    if (window.dbAdmin && window.dbAdmin.reloadDiag) {
                        window.dbAdmin.reloadDiag();
                    }
                    break;
            }
        });
    });
    
    // Selects com data-action
    document.querySelectorAll('select[data-action]').forEach(function(select) {
        select.addEventListener('change', function() {
            const action = this.getAttribute('data-action');
            
            switch(action) {
                case 'update-logs':
                    if (window.dbAdmin && window.dbAdmin.updateLogs) {
                        window.dbAdmin.updateLogs();
                    }
                    break;
                case 'update-trends':
                    if (window.dbAdmin && window.dbAdmin.updateTrends) {
                        window.dbAdmin.updateTrends();
                    }
                    break;
            }
        });
    });
});
</script>
{% endblock %}

</style>

<style>
/* Container */
.db-container {
    padding: 2rem;
    max-width: 1600px;
    margin: 0 auto;
    animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Hero Header */
.db-hero {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    border-radius: 20px;
    padding: 3rem 2.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 10px 40px rgba(59, 130, 246, 0.3);
    position: relative;
    overflow: hidden;
}

.db-hero::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    animation: rotate 20s linear infinite;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.db-hero-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    z-index: 1;
    flex-wrap: wrap;
    gap: 1.5rem;
}

.db-title {
    font-size: 3rem;
    font-weight: 800;
    color: white;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 1rem;
    text-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.db-title-icon {
    font-size: 3.5rem;
    animation: bounce 2s ease-in-out infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.db-subtitle {
    font-size: 1.25rem;
    color: rgba(255, 255, 255, 0.9);
    margin-top: 0.5rem;
}

.db-hero-actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.btn-action {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 1.75rem;
    border-radius: 12px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    font-size: 1rem;
}

.btn-action-primary {
    background: white;
    color: #3b82f6;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.btn-action-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}

.btn-action-secondary {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 2px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(10px);
}

.btn-action-secondary:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}

/* Info Box */
.db-info-box-modern {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.25rem 1.5rem;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.05));
    border-left: 4px solid #3b82f6;
    border-radius: 12px;
    margin-bottom: 2rem;
}

.db-info-box-modern i {
    font-size: 1.5rem;
    color: #3b82f6;
    flex-shrink: 0;
    margin-top: 0.125rem;
}

.db-info-box-modern strong {
    display: block;
    font-size: 1rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 0.5rem;
}

.db-info-box-modern p {
    margin: 0;
    font-size: 0.875rem;
    color: #6b7280;
    line-height: 1.6;
}

/* Alert */
.db-alert-modern {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.25rem 1.5rem;
    border-radius: 12px;
    margin-bottom: 2rem;
}

.db-alert-warning {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(217, 119, 6, 0.05));
    border-left: 4px solid #f59e0b;
    color: #92400e;
}

.db-alert-modern i {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.db-alert-modern strong {
    display: block;
    margin-bottom: 0.5rem;
    font-size: 1rem;
}

.db-alert-modern p {
    margin: 0;
    font-size: 0.875rem;
}

/* Cards */
.db-card-modern {
    background: white;
    border-radius: 16px;
    padding: 1.75rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    border: 1px solid rgba(0,0,0,0.05);
    margin-bottom: 2rem;
}

.db-card-highlight {
    border-left: 4px solid;
}

.db-card-success {
    border-left-color: #10b981;
}

.db-card-header-modern {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #f3f4f6;
    flex-wrap: wrap;
    gap: 1rem;
}

.db-card-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1f2937;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin: 0;
}

.db-card-title i {
    color: #667eea;
}

.db-card-badges {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
}

.db-card-body-modern {
    padding: 0;
}

.db-card-footer-modern {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding-top: 1rem;
    margin-top: 1rem;
    border-top: 2px solid #f3f4f6;
    font-size: 0.875rem;
    color: #6b7280;
}

.db-card-footer-modern i {
    color: #667eea;
}

/* Charts */
.db-charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1.5rem;
}

.db-chart-card {
    background: #f9fafb;
    border-radius: 12px;
    padding: 1.5rem;
    border: 2px solid #e5e7eb;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.db-chart-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.db-chart-header {
    margin-bottom: 1rem;
}

.db-chart-label {
    font-size: 0.875rem;
    font-weight: 600;
    color: #374151;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.db-chart-label i {
    color: #667eea;
    font-size: 1.125rem;
}

.db-chart-wrapper {
    height: 120px;
    max-height: 120px;
    min-height: 120px;
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
}

.db-chart-wrapper canvas {
    max-height: 120px !important;
    height: 120px !important;
    width: 100% !important;
    display: block;
}

/* Iframe */
.db-iframe-wrapper {
    padding: 0;
    border-radius: 12px;
    overflow: hidden;
}

.db-iframe-modern {
    width: 100%;
    border: none;
    border-radius: 0 0 12px 12px;
    min-height: 400px;
}

/* Stats Grid */
.db-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.db-stat-item-modern {
    background: #f9fafb;
    border-radius: 12px;
    padding: 1.25rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    border: 2px solid #e5e7eb;
    transition: all 0.3s ease;
}

.db-stat-item-modern:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.db-stat-icon-modern {
    width: 48px;
    height: 48px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    flex-shrink: 0;
}

.db-stat-icon-file {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
}

.db-stat-icon-size {
    background: linear-gradient(135deg, #10b981, #059669);
}

.db-stat-icon-time {
    background: linear-gradient(135deg, #f59e0b, #d97706);
}

.db-stat-content-modern {
    flex: 1;
}

.db-stat-label-modern {
    font-size: 0.75rem;
    color: #6b7280;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.25rem;
}

.db-stat-value-modern {
    font-size: 1.125rem;
    font-weight: 700;
    color: #1f2937;
}

.db-download-action {
    display: flex;
    justify-content: center;
    margin-top: 1rem;
}

/* Tables */
.db-table-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

.db-table-modern {
    width: 100%;
    border-collapse: collapse;
}

.db-table-modern th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: #374151;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 2px solid #e5e7eb;
    background: #f9fafb;
}

.db-table-row {
    border-bottom: 1px solid #f3f4f6;
    transition: background 0.2s ease;
}

.db-table-row:hover {
    background: #f9fafb;
}

.db-table-modern td {
    padding: 1rem;
    color: #1f2937;
}

.db-file-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.db-file-icon {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.1));
    color: #3b82f6;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.125rem;
    flex-shrink: 0;
}

.db-file-name {
    font-weight: 600;
    color: #1f2937;
}

.db-table-date {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #6b7280;
    font-size: 0.875rem;
}

.db-user-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.db-user-avatar {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
    font-weight: 700;
    flex-shrink: 0;
}

.db-user-name {
    font-weight: 600;
    color: #1f2937;
}

.db-code-modern {
    font-family: 'JetBrains Mono', 'Courier New', monospace;
    font-size: 0.75rem;
    background: #f3f4f6;
    padding: 0.375rem 0.75rem;
    border-radius: 6px;
    color: #1f2937;
    border: 1px solid #e5e7eb;
}

.db-user-agent {
    color: #6b7280;
    font-size: 0.875rem;
    max-width: 300px;
}

.db-text-truncate {
    display: block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* Badges */
.db-badge-modern {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.375rem 0.75rem;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 600;
}

.db-badge-primary {
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
}

.db-badge-success {
    background: rgba(16, 185, 129, 0.1);
    color: #059669;
}

.db-badge-info {
    background: rgba(59, 130, 246, 0.1);
    color: #2563eb;
}

/* Buttons */
.db-btn-modern {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    font-size: 0.875rem;
}

.db-btn-primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
}

.db-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.db-btn-success {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
}

.db-btn-success:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
}

.db-btn-outline {
    background: white;
    color: #374151;
    border: 2px solid #e5e7eb;
}

.db-btn-outline:hover {
    background: #f3f4f6;
    border-color: #d1d5db;
}

.db-btn-warning {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: white;
}

.db-btn-warning:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
}

.db-btn-action-small {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f3f4f6;
    color: #374151;
    border: none;
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: pointer;
}

.db-btn-action-small:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.db-btn-view:hover {
    background: #3b82f6;
    color: white;
}

.db-btn-restore:hover {
    background: #f59e0b;
    color: white;
}

.db-btn-delete:hover {
    background: #ef4444;
    color: white;
}

/* Actions */
.db-actions-modern {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    align-items: center;
}

/* Pagination */
.db-pagination-modern {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 2px solid #f3f4f6;
}

.db-pagination-info {
    font-size: 0.875rem;
    color: #6b7280;
}

.db-pagination-btns {
    display: flex;
    gap: 0.5rem;
}

.db-btn-pagination {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1.25rem;
    background: white;
    color: #374151;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.3s ease;
    font-size: 0.875rem;
    font-weight: 600;
}

.db-btn-pagination:hover:not(.db-disabled) {
    background: #f3f4f6;
    border-color: #667eea;
    color: #667eea;
}

.db-disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
}

/* Empty States */
.db-empty-state-large {
    text-align: center;
    padding: 4rem 2rem;
}

.db-empty-state-large i {
    font-size: 4rem;
    color: #667eea;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.db-empty-state-large h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1f2937;
    margin: 0 0 0.5rem 0;
}

.db-empty-state-large p {
    font-size: 1rem;
    color: #6b7280;
    margin: 0;
}

/* Utilities */
.text-center {
    text-align: center;
}

.text-right {
    text-align: right;
}

/* Responsive */
@media (max-width: 1024px) {
    .db-charts-grid,
    .db-stats-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .db-container {
        padding: 1rem;
    }

    .db-hero {
        padding: 2rem 1.5rem;
    }

    .db-title {
        font-size: 2rem;
    }

    .db-hero-actions {
        width: 100%;
    }

    .db-hero-actions .btn-action {
        flex: 1;
        justify-content: center;
    }

    .db-card-header-modern {
        flex-direction: column;
        align-items: flex-start;
    }

    .db-table-wrapper {
        overflow-x: scroll;
    }

    .db-pagination-modern {
        flex-direction: column;
        gap: 1rem;
    }
}

/* Dark Mode */
[data-theme="dark"] .db-card-modern,
[data-theme="dark"] .db-stat-item-modern,
[data-theme="dark"] .db-chart-card {
    background: #1f2937;
    border-color: #374151;
}

[data-theme="dark"] .db-card-title,
[data-theme="dark"] .db-stat-value-modern,
[data-theme="dark"] .db-file-name,
[data-theme="dark"] .db-user-name {
    color: #f9fafb;
}

[data-theme="dark"] .db-card-footer-modern,
[data-theme="dark"] .db-stat-label-modern,
[data-theme="dark"] .db-table-date,
[data-theme="dark"] .db-user-agent {
    color: #9ca3af;
}

/* Dark Mode - Score de Saúde */
[data-theme="dark"] .db-card-footer-modern .db-info-box-modern p,
[data-theme="dark"] .db-card-footer-modern .db-info-box-modern ul,
[data-theme="dark"] .db-card-footer-modern .db-info-box-modern li {
    color: #e5e7eb !important;
}

[data-theme="dark"] .db-card-footer-modern .db-info-box-modern strong {
    color: #93c5fd !important;
}

[data-theme="dark"] .db-table-modern th {
    background: #374151;
    color: #e5e7eb;
}

[data-theme="dark"] .db-table-modern td {
    color: #f3f4f6;
}

[data-theme="dark"] .db-table-modern td .mm-text-muted,
[data-theme="dark"] .db-table-modern td .db-table-date,
[data-theme="dark"] .db-table-modern td .db-user-agent {
    color: #d1d5db !important;
}

[data-theme="dark"] .db-table-row:hover {
    background: #374151;
}

[data-theme="dark"] .db-code-modern {
    background: #374151;
    border-color: #4b5563;
    color: #f9fafb;
}

/* Health Checks */
.db-health-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1rem;
}

.db-health-item {
    background: #f9fafb;
    border-radius: 12px;
    padding: 1.25rem;
    border: 2px solid #e5e7eb;
    transition: all 0.3s ease;
}

.db-health-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.db-health-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
}

.db-health-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.db-health-title {
    font-weight: 600;
    color: #1f2937;
    flex: 1;
}

.db-health-message {
    font-size: 0.875rem;
    color: #374151;
    margin-bottom: 0.5rem;
    line-height: 1.5;
}

.db-health-detail {
    font-size: 0.75rem;
    color: #6b7280;
    margin-top: 0.25rem;
}

.db-health-time {
    font-size: 0.75rem;
    color: #9ca3af;
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px solid #e5e7eb;
}

.db-badge-danger {
    background: rgba(239, 68, 68, 0.1);
    color: #dc2626;
}

.db-badge-warning {
    background: rgba(245, 158, 11, 0.1);
    color: #d97706;
}

/* Logs */
.db-logs-controls {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    align-items: center;
}

.db-select-modern {
    padding: 0.5rem 0.75rem;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 0.875rem;
    background: white;
    color: #374151;
    cursor: pointer;
    transition: all 0.3s ease;
}

.db-select-modern:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.db-logs-container {
    background: #1f2937;
    border-radius: 8px;
    padding: 1rem;
    max-height: 400px;
    overflow-y: auto;
    font-family: 'Courier New', monospace;
    font-size: 0.75rem;
    line-height: 1.6;
}

.db-logs-loading {
    color: #9ca3af;
    text-align: center;
    padding: 2rem;
}

.db-log-entry {
    padding: 0.5rem;
    margin-bottom: 0.25rem;
    border-radius: 4px;
    border-left: 3px solid;
    background: rgba(255, 255, 255, 0.05);
    display: grid;
    grid-template-columns: 140px 80px 120px 1fr;
    gap: 1rem;
    align-items: start;
}

.db-log-entry.db-log-error {
    border-left-color: #ef4444;
    background: rgba(239, 68, 68, 0.1);
}

.db-log-entry.db-log-warning {
    border-left-color: #f59e0b;
    background: rgba(245, 158, 11, 0.1);
}

.db-log-entry.db-log-info {
    border-left-color: #3b82f6;
}

.db-log-time {
    color: #9ca3af;
    white-space: nowrap;
}

.db-log-level {
    font-weight: 600;
    white-space: nowrap;
}

.db-log-entry.db-log-error .db-log-level {
    color: #fca5a5;
}

.db-log-entry.db-log-warning .db-log-level {
    color: #fcd34d;
}

.db-log-entry.db-log-info .db-log-level {
    color: #93c5fd;
}

.db-log-origin {
    color: #d1d5db;
    white-space: nowrap;
}

.db-log-message {
    color: #e5e7eb;
    word-break: break-word;
}

/* Incidentes */
.db-incidents-controls {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.db-incident-message {
    max-width: 400px;
    word-break: break-word;
    font-size: 0.875rem;
}

/* Dark Mode - Health Checks */
[data-theme="dark"] .db-health-item {
    background: #1f2937;
    border-color: #374151;
}

[data-theme="dark"] .db-health-title {
    color: #f9fafb;
}

[data-theme="dark"] .db-health-message {
    color: #e5e7eb;
}

[data-theme="dark"] .db-health-detail {
    color: #9ca3af;
}

[data-theme="dark"] .db-health-time {
    color: #6b7280;
    border-top-color: #374151;
}

[data-theme="dark"] .db-select-modern {
    background: #374151;
    border-color: #4b5563;
    color: #f9fafb;
}

[data-theme="dark"] .db-incident-message {
    color: #e5e7eb;
}

/* Dashboard Consolidado */
.db-card-highlight {
    border: 2px solid #667eea;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(102, 126, 234, 0.02) 100%);
}

.db-dashboard-grid {
    display: grid;
    grid-template-columns: 250px 1fr;
    gap: 2rem;
    align-items: start;
}

.db-dashboard-score-card {
    text-align: center;
    padding: 1.5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 16px;
    color: white;
}

.db-dashboard-score-value {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.db-dashboard-score-label {
    font-size: 0.875rem;
    opacity: 0.9;
    margin-bottom: 1rem;
}

.db-dashboard-score-bar {
    height: 8px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 4px;
    overflow: hidden;
}

.db-dashboard-score-fill {
    height: 100%;
    background: white;
    transition: width 0.5s ease;
}

.db-dashboard-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.db-dashboard-stat {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: #f9fafb;
    border-radius: 12px;
    border: 2px solid #e5e7eb;
}

.db-dashboard-stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    flex-shrink: 0;
}

.db-dashboard-stat-icon.db-dashboard-stat-alerts {
    background: rgba(245, 158, 11, 0.1);
    color: #d97706;
}

.db-dashboard-stat-icon.db-dashboard-stat-incidents {
    background: rgba(239, 68, 68, 0.1);
    color: #dc2626;
}

.db-dashboard-stat-icon.db-dashboard-stat-db {
    background: rgba(59, 130, 246, 0.1);
    color: #2563eb;
}

.db-dashboard-stat-icon.db-dashboard-stat-disk {
    background: rgba(34, 197, 94, 0.1);
    color: #16a34a;
}

.db-dashboard-stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1f2937;
}

.db-dashboard-stat-label {
    font-size: 0.875rem;
    color: #6b7280;
}

/* Alertas */
.db-alerts-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.db-alert-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
    border-radius: 12px;
    border: 2px solid;
    background: #f9fafb;
}

.db-alert-item.db-alert-critical {
    border-color: #ef4444;
    background: rgba(239, 68, 68, 0.05);
}

.db-alert-item.db-alert-warning {
    border-color: #f59e0b;
    background: rgba(245, 158, 11, 0.05);
}

.db-alert-item.db-alert-info {
    border-color: #3b82f6;
    background: rgba(59, 130, 246, 0.05);
}

.db-alert-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.db-alert-item.db-alert-critical .db-alert-icon {
    color: #ef4444;
}

.db-alert-item.db-alert-warning .db-alert-icon {
    color: #f59e0b;
}

.db-alert-item.db-alert-info .db-alert-icon {
    color: #3b82f6;
}

.db-alert-content {
    flex: 1;
}

.db-alert-title {
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 0.25rem;
}

.db-alert-details {
    font-size: 0.875rem;
    color: #6b7280;
    display: flex;
    gap: 1rem;
    align-items: center;
}

.db-alert-time {
    color: #9ca3af;
    font-size: 0.75rem;
}

/* Tendências */
.db-trends-controls {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.db-trends-chart-wrapper {
    height: 300px;
    margin-bottom: 1rem;
}

.db-trends-stats {
    display: flex;
    gap: 2rem;
    padding: 1rem;
    background: #f9fafb;
    border-radius: 8px;
}

.db-trend-stats-item {
    font-size: 0.875rem;
    color: #374151;
}

.db-trend-stats-item strong {
    color: #1f2937;
    margin-right: 0.5rem;
}

/* Manutenção */
.db-maintenance-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.db-maintenance-action {
    display: flex;
    gap: 1rem;
    padding: 1.5rem;
    background: #f9fafb;
    border-radius: 12px;
    border: 2px solid #e5e7eb;
}

.db-maintenance-icon {
    width: 56px;
    height: 56px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.75rem;
    flex-shrink: 0;
}

.db-maintenance-icon.db-maintenance-cleanup {
    background: rgba(34, 197, 94, 0.1);
    color: #16a34a;
}

.db-maintenance-icon.db-maintenance-optimize {
    background: rgba(59, 130, 246, 0.1);
    color: #2563eb;
}

.db-maintenance-icon.db-maintenance-verify {
    background: rgba(245, 158, 11, 0.1);
    color: #d97706;
}

.db-maintenance-content {
    flex: 1;
}

.db-maintenance-content h4 {
    font-size: 1.125rem;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 0.5rem;
}

.db-maintenance-content p {
    font-size: 0.875rem;
    color: #6b7280;
    margin-bottom: 1rem;
}

.db-maintenance-history {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 2px solid #e5e7eb;
}

.db-maintenance-history h4 {
    font-size: 1.125rem;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 1rem;
}

/* Dark Mode - Dashboard */
[data-theme="dark"] .db-card-highlight {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(102, 126, 234, 0.1) 100%);
    border-color: #667eea;
}

/* Git Update Card Styles */
#gitUpdateCard {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

.db-git-info {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.db-git-repo-info {
    display: flex;
    gap: 2rem;
    flex-wrap: wrap;
    padding: 1rem;
    background: rgba(59, 130, 246, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(59, 130, 246, 0.2);
}

.db-git-repo-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.db-git-label {
    font-weight: 600;
    color: #4b5563;
    font-size: 0.875rem;
}

.db-git-value {
    font-weight: 500;
    color: #1f2937;
    font-size: 0.875rem;
    padding: 0.25rem 0.75rem;
    background: white;
    border-radius: 6px;
    border: 1px solid #e5e7eb;
}

.db-git-link {
    color: #2563eb;
    text-decoration: none;
    font-size: 0.875rem;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    transition: color 0.2s;
}

.db-git-link:hover {
    color: #1d4ed8;
    text-decoration: underline;
}

.db-git-status-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
}

.db-git-status-item {
    padding: 1rem;
    background: white;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
}

.db-git-status-label {
    font-size: 0.75rem;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.db-git-status-value {
    font-size: 1rem;
    font-weight: 600;
    color: #1f2937;
    word-break: break-all;
    margin-bottom: 0.25rem;
}

.db-git-status-hint {
    font-size: 0.7rem;
    color: #9ca3af;
    font-style: italic;
    display: block;
    margin-top: 0.25rem;
}

.db-git-status-hint {
    font-size: 0.7rem;
    color: #9ca3af;
    font-style: italic;
    display: block;
    margin-top: 0.25rem;
}

.db-git-commit-message {
    font-size: 0.875rem;
    font-weight: 400;
    color: #4b5563;
    font-style: italic;
}

.db-git-update-status {
    padding: 1rem;
    border-radius: 8px;
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.db-git-update-indicator {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: #6b7280;
    font-size: 0.875rem;
}

.db-git-update-indicator i {
    animation: spin 1s linear infinite;
}

.db-git-update-indicator.update-available {
    background: rgba(16, 185, 129, 0.1);
    color: #059669;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    border: 1px solid rgba(16, 185, 129, 0.3);
}

.db-git-update-indicator.update-available i {
    animation: none;
}

.db-git-update-indicator.up-to-date {
    background: rgba(59, 130, 246, 0.1);
    color: #2563eb;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    border: 1px solid rgba(59, 130, 246, 0.3);
}

.db-git-update-indicator.error {
    background: rgba(239, 68, 68, 0.1);
    color: #dc2626;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    border: 1px solid rgba(239, 68, 68, 0.3);
}

.db-git-actions {
    display: flex;
    justify-content: center;
    gap: 1rem;
}

.db-btn-lg {
    padding: 1rem 2rem;
    font-size: 1.1rem;
    min-width: 250px;
}

/* Modal de Confirmação */
.db-git-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    padding: 1rem;
}

.db-git-modal {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    max-width: 800px;
    width: 100%;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
}

.db-git-modal-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
}

.db-git-modal-header i {
    font-size: 1.5rem;
    color: #f59e0b;
}

.db-git-modal-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1f2937;
    margin: 0;
}

.db-git-modal-body {
    margin-bottom: 1.5rem;
    overflow-y: auto;
    flex: 1;
    min-height: 0;
    max-height: calc(90vh - 200px);
}

.db-git-modal-body p {
    color: #4b5563;
    line-height: 1.6;
    margin-bottom: 1rem;
}

.db-git-countdown-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 2rem 0;
    padding: 2rem;
    background: rgba(59, 130, 246, 0.05);
    border-radius: 12px;
    border: 2px solid rgba(59, 130, 246, 0.2);
}

.db-git-countdown {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    text-align: center;
}

@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.1);
    }
}

@keyframes spin {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}

.db-git-processing-msg,
.db-git-success-msg,
.db-git-error-msg {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 1.25rem;
    border-radius: 8px;
    margin-top: 1rem;
    font-size: 0.95rem;
    min-height: 60px;
    word-wrap: break-word;
}

.db-git-processing-msg {
    background: rgba(59, 130, 246, 0.1);
    color: #2563eb;
    border: 1px solid rgba(59, 130, 246, 0.3);
}

.db-git-success-msg {
    background: rgba(16, 185, 129, 0.1);
    color: #059669;
}

/* Manutenção Melhorada - Estilos Adicionais */
.db-maintenance-quick-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
}

.db-quick-stat-item {
    display: flex;
    flex-direction: column;
    padding: 0.75rem;
    background: #f9fafb;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
}

.db-quick-stat-label {
    font-size: 0.75rem;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.25rem;
}

.db-quick-stat-value {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1f2937;
}

.db-recommendations-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.db-recommendation-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 1rem;
    border-radius: 8px;
    border-left: 4px solid #6b7280;
    background: #f9fafb;
}

.db-recommendation-item.db-rec-high {
    border-left-color: #ef4444;
    background: #fef2f2;
}

.db-recommendation-item.db-rec-medium {
    border-left-color: #f59e0b;
    background: #fffbeb;
}

.db-recommendation-item.db-rec-low {
    border-left-color: #3b82f6;
    background: #eff6ff;
}

.db-recommendation-item i {
    font-size: 1.25rem;
    margin-top: 0.125rem;
}

.db-recommendation-item.db-rec-high i {
    color: #ef4444;
}

.db-recommendation-item.db-rec-medium i {
    color: #f59e0b;
}

.db-recommendation-item.db-rec-low i {
    color: #3b82f6;
}

.db-recommendation-item span {
    flex: 1;
    color: #1f2937;
    line-height: 1.5;
}

.db-no-recommendations {
    padding: 1.5rem;
    text-align: center;
    color: #6b7280;
    font-style: italic;
}

[data-theme="dark"] .db-quick-stat-item {
    background: #1f2937;
    border-color: #374151;
}

[data-theme="dark"] .db-quick-stat-value {
    color: #f9fafb;
}

[data-theme="dark"] .db-recommendation-item {
    background: #1f2937;
}

[data-theme="dark"] .db-recommendation-item.db-rec-high {
    background: #7f1d1d;
}

[data-theme="dark"] .db-recommendation-item.db-rec-medium {
    background: #78350f;
}

[data-theme="dark"] .db-recommendation-item.db-rec-low {
    background: #1e3a8a;
}

[data-theme="dark"] .db-recommendation-item span {
    color: #f9fafb;
}
    border: 1px solid rgba(16, 185, 129, 0.3);
}

.db-git-error-msg {
    background: rgba(239, 68, 68, 0.1);
    color: #dc2626;
    border: 1px solid rgba(239, 68, 68, 0.3);
    max-width: 100%;
    overflow-wrap: break-word;
    word-wrap: break-word;
}

.db-git-error-msg pre,
.db-git-error-msg div {
    max-width: 100%;
    overflow-wrap: break-word;
    word-wrap: break-word;
    white-space: pre-wrap;
}

/* Responsive: Modal em telas menores */
@media (max-width: 768px) {
    .db-git-modal {
        max-width: 95vw;
        max-height: 95vh;
        padding: 1.5rem;
    }
    
    .db-git-modal-body {
        max-height: calc(95vh - 180px);
    }
}

.db-git-notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    z-index: 10001;
    max-width: 400px;
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.db-git-notification-content {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
}

.db-git-notification-content i {
    font-size: 1.5rem;
    color: #2563eb;
    flex-shrink: 0;
}

.db-git-notification-content strong {
    display: block;
    margin-bottom: 0.5rem;
    color: #1f2937;
}

.db-git-notification-content p {
    margin: 0;
    color: #6b7280;
    font-size: 0.9rem;
    line-height: 1.5;
}

.db-git-countdown-value {
    font-size: 3rem;
    font-weight: 800;
    color: #dc2626;
    line-height: 1;
}

.db-git-countdown-label {
    font-size: 0.875rem;
    color: #6b7280;
    margin-top: 0.5rem;
}

.db-git-modal-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
}

.db-git-modal-btn {
    padding: 0.625rem 1.25rem;
    border-radius: 8px;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
}

.db-git-modal-btn-cancel {
    background: #f3f4f6;
    color: #374151;
}

.db-git-modal-btn-cancel:hover {
    background: #e5e7eb;
}

.db-git-modal-btn-confirm {
    background: #dc2626;
    color: white;
}

.db-git-modal-btn-confirm:hover {
    background: #b91c1c;
}

.db-git-modal-btn-confirm:disabled {
    background: #9ca3af;
    cursor: not-allowed;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

[data-theme="dark"] .db-dashboard-stat {
    background: #1f2937;
    border-color: #374151;
}

[data-theme="dark"] .db-dashboard-stat-value {
    color: #f9fafb;
}

[data-theme="dark"] .db-dashboard-stat-label {
    color: #9ca3af;
}

[data-theme="dark"] .db-alert-item {
    background: #1f2937;
}

[data-theme="dark"] .db-alert-title {
    color: #f9fafb;
}

[data-theme="dark"] .db-alert-details {
    color: #9ca3af;
}

[data-theme="dark"] .db-trends-stats {
    background: #1f2937;
}

[data-theme="dark"] .db-trend-stats-item {
    color: #e5e7eb;
}

[data-theme="dark"] .db-trend-stats-item strong {
    color: #f9fafb;
}

[data-theme="dark"] .db-maintenance-action {
    background: #1f2937;
    border-color: #374151;
}

[data-theme="dark"] .db-maintenance-content h4 {
    color: #f9fafb;
}

[data-theme="dark"] .db-maintenance-content p {
    color: #9ca3af;
}

[data-theme="dark"] .db-maintenance-history {
    border-top-color: #374151;
}

[data-theme="dark"] .db-maintenance-history h4 {
    color: #f9fafb;
}
</style>
{% endblock %}
