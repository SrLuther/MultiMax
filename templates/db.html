{% extends 'base.html' %}
{% block title %}Banco de Dados — MultiMax{% endblock %}

{% block content %}
<div class="db-container">
    <!-- Hero Header -->
    <div class="db-hero">
        <div class="db-hero-content">
            <div>
                <h1 class="db-title">
                    <i class="bi bi-database db-title-icon"></i>
                    Banco de Dados
                </h1>
                <p class="db-subtitle">Gerencie backups e monitore a saúde do sistema</p>
            </div>
            <div class="db-hero-actions">
                <form method="post" action="{{ url_for('dbadmin.backup_now') }}">
                    <button type="submit" class="btn-action btn-action-primary">
                        <i class="bi bi-cloud-arrow-up"></i>
                        <span>Criar Backup</span>
                    </button>
                </form>
                {% if is_sqlite %}
                <form method="post" action="{{ url_for('dbadmin.restaurar_snapshot') }}" onsubmit="return confirm('Restaurar o último snapshot? Esta ação sobrescreve o banco atual.')">
                    <button type="submit" class="btn-action btn-action-secondary">
                        <i class="bi bi-arrow-counterclockwise"></i>
                        <span>Restaurar Snapshot</span>
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Info Box -->
    <div class="db-info-box-modern">
        <i class="bi bi-info-circle"></i>
        <div>
            <strong>Backups Automáticos</strong>
            <p>Backups automáticos a cada 15 minutos (mínimo). Mantém no máximo 20 mais recentes. Inclui backup-24h.sqlite atualizado diariamente às 00h.</p>
        </div>
    </div>

    {% if not is_sqlite %}
    <div class="db-alert-modern db-alert-warning">
        <i class="bi bi-exclamation-triangle"></i>
        <div>
            <strong>Atenção</strong>
            <p>Backup automático está disponível apenas quando o banco é SQLite.</p>
        </div>
    </div>
    {% endif %}

    <!-- Uso de Recursos -->
    <div class="db-card-modern">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-cpu"></i>
                Uso de Recursos da Máquina
            </h3>
            <div class="db-card-badges">
                <span class="db-badge-modern db-badge-info" id="serverClock">Servidor — --:--:--</span>
                <span class="db-badge-modern db-badge-primary">Atualiza a cada 1s</span>
            </div>
        </div>
        <div class="db-card-body-modern">
            <div class="db-charts-grid">
                <div class="db-chart-card">
                    <div class="db-chart-header">
                        <div class="db-chart-label">
                            <i class="bi bi-cpu-fill"></i>
                            CPU (%)
                        </div>
                    </div>
                    <div class="db-chart-wrapper">
                        <canvas id="cpuChart"></canvas>
                    </div>
                </div>
                <div class="db-chart-card">
                    <div class="db-chart-header">
                        <div class="db-chart-label">
                            <i class="bi bi-memory"></i>
                            Memória (%)
                        </div>
                    </div>
                    <div class="db-chart-wrapper">
                        <canvas id="memChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="db-card-footer-modern">
            <i class="bi bi-server"></i>
            <span>Origem: host local do MultiMax</span>
        </div>
    </div>

    <!-- Diagnóstico Completo -->
    <div class="db-card-modern" id="problems_and_diagnostics">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-activity"></i>
                Diagnóstico Completo
            </h3>
            <button type="button" class="db-btn-modern db-btn-outline" onclick="reloadDiag()">
                <i class="bi bi-arrow-repeat"></i>
                Recarregar
            </button>
        </div>
        <div class="db-card-body-modern db-iframe-wrapper">
            <iframe id="dbStatusFrame" src="{{ url_for('_dbstatus') }}" class="db-iframe-modern"></iframe>
        </div>
    </div>

    <!-- Backup Diário -->
    {% if daily_backup %}
    <div class="db-card-modern db-card-highlight db-card-success">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-calendar-check"></i>
                Backup Diário (24h)
            </h3>
            <span class="db-badge-modern db-badge-success">
                <i class="bi bi-clock-history"></i>
                Atualizado diariamente às 00h
            </span>
        </div>
        <div class="db-card-body-modern">
            <div class="db-stats-grid">
                <div class="db-stat-item-modern">
                    <div class="db-stat-icon-modern db-stat-icon-file">
                        <i class="bi bi-file-earmark-zip"></i>
                    </div>
                    <div class="db-stat-content-modern">
                        <div class="db-stat-label-modern">Arquivo</div>
                        <div class="db-stat-value-modern">{{ daily_backup.name }}</div>
                    </div>
                </div>
                <div class="db-stat-item-modern">
                    <div class="db-stat-icon-modern db-stat-icon-size">
                        <i class="bi bi-hdd"></i>
                    </div>
                    <div class="db-stat-content-modern">
                        <div class="db-stat-label-modern">Tamanho</div>
                        <div class="db-stat-value-modern">{{ '%.2f'|format((daily_backup.size or 0)/1024/1024) }} MB</div>
                    </div>
                </div>
                <div class="db-stat-item-modern">
                    <div class="db-stat-icon-modern db-stat-icon-time">
                        <i class="bi bi-clock"></i>
                    </div>
                    <div class="db-stat-content-modern">
                        <div class="db-stat-label-modern">Última atualização</div>
                        <div class="db-stat-value-modern">{{ daily_backup.mtime_str }}</div>
                    </div>
                </div>
            </div>
            <div class="db-download-action">
                <a class="db-btn-modern db-btn-success" href="{{ url_for('dbadmin.download', name=daily_backup.name) }}">
                    <i class="bi bi-download"></i>
                    Baixar Backup 24h
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Backups Recentes -->
    <div class="db-card-modern">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-archive"></i>
                Backups Recentes
            </h3>
            <a class="db-btn-modern db-btn-outline" href="{{ url_for('dbadmin.index') }}">
                <i class="bi bi-arrow-repeat"></i>
                Atualizar
            </a>
        </div>
        <div class="db-card-body-modern">
            {% if backups %}
            <div class="db-table-wrapper">
                <table class="db-table-modern">
                    <thead>
                        <tr>
                            <th>Arquivo</th>
                            <th class="text-right">Tamanho</th>
                            <th>Modificado</th>
                            <th class="text-center">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for it in backups %}
                        <tr class="db-table-row">
                            <td>
                                <div class="db-file-info">
                                    <div class="db-file-icon">
                                        <i class="bi bi-file-earmark-zip"></i>
                                    </div>
                                    <div class="db-file-name">{{ it.name }}</div>
                                </div>
                            </td>
                            <td class="text-right">
                                <span class="db-badge-modern db-badge-info">{{ '%.2f'|format((it.size or 0)/1024/1024) }} MB</span>
                            </td>
                            <td class="db-table-date">
                                <i class="bi bi-calendar3"></i>
                                {{ it.mtime_str }}
                            </td>
                            <td>
                                <div class="db-actions-modern">
                                    <a class="db-btn-action-small db-btn-view" href="{{ url_for('dbadmin.download', name=it.name) }}" title="Baixar">
                                        <i class="bi bi-download"></i>
                                    </a>
                                    {% if is_sqlite %}
                                    <form method="post" action="{{ url_for('dbadmin.restaurar', name=it.name) }}" onsubmit="return confirm('Restaurar este backup? Esta ação sobrescreve o banco atual.')" style="display: inline;">
                                        <button class="db-btn-action-small db-btn-restore" type="submit" title="Restaurar">
                                            <i class="bi bi-arrow-counterclockwise"></i>
                                        </button>
                                    </form>
                                    {% endif %}
                                    <form method="post" action="{{ url_for('dbadmin.excluir', name=it.name) }}" onsubmit="return confirm('Excluir backup {{ it.name }}?')" style="display: inline;">
                                        <button class="db-btn-action-small db-btn-delete" type="submit" title="Excluir">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="db-pagination-modern">
                <span class="db-pagination-info">Página {{ page }} de {{ total_pages }}</span>
                <div class="db-pagination-btns">
                    <a class="db-btn-pagination {% if page <= 1 %}db-disabled{% endif %}" href="{{ url_for('dbadmin.index') }}?page={{ page-1 if page>1 else 1 }}">
                        <i class="bi bi-chevron-left"></i>
                        Anterior
                    </a>
                    <a class="db-btn-pagination {% if page >= total_pages %}db-disabled{% endif %}" href="{{ url_for('dbadmin.index') }}?page={{ page+1 if page<total_pages else total_pages }}">
                        Próximo
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </div>
            </div>
            {% else %}
            <div class="db-empty-state-large">
                <i class="bi bi-archive"></i>
                <h3>Nenhum backup disponível</h3>
                <p>Nenhum backup foi criado ainda. Use o botão "Criar Backup" para criar o primeiro backup.</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Histórico de Conexões -->
    <div class="db-card-modern">
        <div class="db-card-header-modern">
            <h3 class="db-card-title">
                <i class="bi bi-person-check"></i>
                Histórico de Conexões
            </h3>
            <span class="db-badge-modern db-badge-info">Últimos logins</span>
        </div>
        <div class="db-card-body-modern">
            {% if logins %}
            <div class="db-table-wrapper">
                <table class="db-table-modern">
                    <thead>
                        <tr>
                            <th>Usuário</th>
                            <th>IP</th>
                            <th>Navegador</th>
                            <th>Data/Hora</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for login in logins %}
                        <tr class="db-table-row">
                            <td>
                                <div class="db-user-info">
                                    <div class="db-user-avatar">
                                        {{ (login.username or '?')[:2].upper() }}
                                    </div>
                                    <div class="db-user-name">{{ login.username or '-' }}</div>
                                </div>
                            </td>
                            <td>
                                <code class="db-code-modern">{{ login.ip_address or '-' }}</code>
                            </td>
                            <td class="db-user-agent">
                                <span class="db-text-truncate">{{ (login.user_agent or '-')[:50] }}{% if login.user_agent and login.user_agent|length > 50 %}...{% endif %}</span>
                            </td>
                            <td class="db-table-date">
                                <i class="bi bi-calendar3"></i>
                                {{ login.login_at.strftime('%d/%m/%Y %H:%M') if login.login_at else '-' }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if logins_pag %}
            <div class="db-pagination-modern">
                <span class="db-pagination-info">Página {{ logins_pag.page }} de {{ logins_pag.pages or 1 }}</span>
                <div class="db-pagination-btns">
                    <a class="db-btn-pagination {% if not logins_pag.has_prev %}db-disabled{% endif %}" href="{{ url_for('dbadmin.index') }}?login_page={{ logins_pag.prev_num or 1 }}">
                        <i class="bi bi-chevron-left"></i>
                        Anterior
                    </a>
                    <a class="db-btn-pagination {% if not logins_pag.has_next %}db-disabled{% endif %}" href="{{ url_for('dbadmin.index') }}?login_page={{ logins_pag.next_num or logins_pag.pages or 1 }}">
                        Próximo
                        <i class="bi bi-chevron-right"></i>
                    </a>
                </div>
            </div>
            {% endif %}
            {% else %}
            <div class="db-empty-state-large">
                <i class="bi bi-person-x"></i>
                <h3>Nenhum registro de login</h3>
                <p>Nenhum registro de login foi encontrado ainda.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
var __mmChartsLoaded = false;
function ensureChartJs(cb){
  if (window.Chart) { __mmChartsLoaded = true; cb(); return; }
  if (__mmChartsLoaded) { cb(); return; }
  var s = document.createElement('script');
  s.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js';
  s.onload = function(){ __mmChartsLoaded = true; cb(); };
  document.head.appendChild(s);
}
function startResourceCharts(){
  var cpuCtx = document.getElementById('cpuChart');
  var memCtx = document.getElementById('memChart');
  if (!cpuCtx || !memCtx) return;
  var labels = [];
  var cpuData = [];
  var memData = [];
  var cpuChart = new Chart(cpuCtx, {
    type: 'line',
    data: { labels: labels, datasets: [{ label: 'CPU %', data: cpuData, borderColor: '#3b82f6', backgroundColor: 'rgba(59,130,246,0.15)', tension: 0.25, fill: true }] },
    options: { 
        responsive: true, 
        maintainAspectRatio: false,
        animation: false, 
        plugins: {
            legend: { display: false }
        },
        scales: { 
            y: { beginAtZero: true, max: 100, grid: { color: 'rgba(0,0,0,0.05)' } },
            x: { grid: { display: false } }
        } 
    }
  });
  var memChart = new Chart(memCtx, {
    type: 'line',
    data: { labels: labels, datasets: [{ label: 'Memória %', data: memData, borderColor: '#22c55e', backgroundColor: 'rgba(34,197,94,0.15)', tension: 0.25, fill: true }] },
    options: { 
        responsive: true, 
        maintainAspectRatio: false,
        animation: false,
        plugins: {
            legend: { display: false }
        },
        scales: { 
            y: { beginAtZero: true, max: 100, grid: { color: 'rgba(0,0,0,0.05)' } },
            x: { grid: { display: false } }
        } 
    }
  });
  function pushPoint(ts, cpu, mem){
    var t = new Date(ts);
    var hh = String(t.getHours()).padStart(2,'0');
    var mm = String(t.getMinutes()).padStart(2,'0');
    var ss = String(t.getSeconds()).padStart(2,'0');
    labels.push(hh+':'+mm+':'+ss);
    cpuData.push(cpu);
    memData.push(mem);
    if (labels.length > 60){ labels.shift(); cpuData.shift(); memData.shift(); }
    cpuChart.update('none');
    memChart.update('none');
  }
  function updateServerClock(ts){
    var el = document.getElementById('serverClock');
    if (!el) return;
    var t = new Date(ts);
    var hh = String(t.getHours()).padStart(2,'0');
    var mm = String(t.getMinutes()).padStart(2,'0');
    var ss = String(t.getSeconds()).padStart(2,'0');
    el.textContent = 'Servidor — ' + hh + ':' + mm + ':' + ss;
  }
  async function fetchMetrics(){
    try{
      var resp = await fetch("{{ url_for('dbadmin.metrics') }}");
      var json = await resp.json();
      if (!json || !json.ok || json.cpu == null || json.mem == null) return;
      pushPoint(json.ts, json.cpu, json.mem);
      updateServerClock(json.ts);
    } catch(e){}
  }
  fetchMetrics();
  setInterval(fetchMetrics, 1000);
}
function resizeDbFrame() {
  var f = document.getElementById('dbStatusFrame');
  if (!f) return;
  try {
    var doc = f.contentWindow && f.contentWindow.document;
    if (!doc) return;
    var h1 = doc.documentElement ? doc.documentElement.scrollHeight : 0;
    var h2 = doc.body ? doc.body.scrollHeight : 0;
    var h = Math.max(h1, h2);
    if (h && h > 0) {
      f.style.height = (h + 16) + 'px';
    }
  } catch (e) {
    // ignore
  }
}
function reloadDiag() {
  var f = document.getElementById('dbStatusFrame');
  if (!f) return;
  var base = f.src.split('?')[0];
  f.src = base + '?t=' + Date.now();
}
document.addEventListener('DOMContentLoaded', function() {
  var f = document.getElementById('dbStatusFrame');
  if (f) {
    f.addEventListener('load', resizeDbFrame);
  }
  ensureChartJs(startResourceCharts);
});
</script>

<style>
/* Container */
.db-container {
    padding: 2rem;
    max-width: 1600px;
    margin: 0 auto;
    animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Hero Header */
.db-hero {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    border-radius: 20px;
    padding: 3rem 2.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 10px 40px rgba(59, 130, 246, 0.3);
    position: relative;
    overflow: hidden;
}

.db-hero::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    animation: rotate 20s linear infinite;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.db-hero-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    z-index: 1;
    flex-wrap: wrap;
    gap: 1.5rem;
}

.db-title {
    font-size: 3rem;
    font-weight: 800;
    color: white;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 1rem;
    text-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.db-title-icon {
    font-size: 3.5rem;
    animation: bounce 2s ease-in-out infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.db-subtitle {
    font-size: 1.25rem;
    color: rgba(255, 255, 255, 0.9);
    margin-top: 0.5rem;
}

.db-hero-actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.btn-action {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 1.75rem;
    border-radius: 12px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    font-size: 1rem;
}

.btn-action-primary {
    background: white;
    color: #3b82f6;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.btn-action-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}

.btn-action-secondary {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 2px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(10px);
}

.btn-action-secondary:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-2px);
}

/* Info Box */
.db-info-box-modern {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.25rem 1.5rem;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.05));
    border-left: 4px solid #3b82f6;
    border-radius: 12px;
    margin-bottom: 2rem;
}

.db-info-box-modern i {
    font-size: 1.5rem;
    color: #3b82f6;
    flex-shrink: 0;
    margin-top: 0.125rem;
}

.db-info-box-modern strong {
    display: block;
    font-size: 1rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 0.5rem;
}

.db-info-box-modern p {
    margin: 0;
    font-size: 0.875rem;
    color: #6b7280;
    line-height: 1.6;
}

/* Alert */
.db-alert-modern {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.25rem 1.5rem;
    border-radius: 12px;
    margin-bottom: 2rem;
}

.db-alert-warning {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(217, 119, 6, 0.05));
    border-left: 4px solid #f59e0b;
    color: #92400e;
}

.db-alert-modern i {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.db-alert-modern strong {
    display: block;
    margin-bottom: 0.5rem;
    font-size: 1rem;
}

.db-alert-modern p {
    margin: 0;
    font-size: 0.875rem;
}

/* Cards */
.db-card-modern {
    background: white;
    border-radius: 16px;
    padding: 1.75rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    border: 1px solid rgba(0,0,0,0.05);
    margin-bottom: 2rem;
}

.db-card-highlight {
    border-left: 4px solid;
}

.db-card-success {
    border-left-color: #10b981;
}

.db-card-header-modern {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #f3f4f6;
    flex-wrap: wrap;
    gap: 1rem;
}

.db-card-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1f2937;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin: 0;
}

.db-card-title i {
    color: #667eea;
}

.db-card-badges {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
}

.db-card-body-modern {
    padding: 0;
}

.db-card-footer-modern {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding-top: 1rem;
    margin-top: 1rem;
    border-top: 2px solid #f3f4f6;
    font-size: 0.875rem;
    color: #6b7280;
}

.db-card-footer-modern i {
    color: #667eea;
}

/* Charts */
.db-charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1.5rem;
}

.db-chart-card {
    background: #f9fafb;
    border-radius: 12px;
    padding: 1.5rem;
    border: 2px solid #e5e7eb;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.db-chart-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.db-chart-header {
    margin-bottom: 1rem;
}

.db-chart-label {
    font-size: 0.875rem;
    font-weight: 600;
    color: #374151;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.db-chart-label i {
    color: #667eea;
    font-size: 1.125rem;
}

.db-chart-wrapper {
    height: 120px;
    max-height: 120px;
    min-height: 120px;
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
}

.db-chart-wrapper canvas {
    max-height: 120px !important;
    height: 120px !important;
    width: 100% !important;
    display: block;
}

/* Iframe */
.db-iframe-wrapper {
    padding: 0;
    border-radius: 12px;
    overflow: hidden;
}

.db-iframe-modern {
    width: 100%;
    border: none;
    border-radius: 0 0 12px 12px;
    min-height: 400px;
}

/* Stats Grid */
.db-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.db-stat-item-modern {
    background: #f9fafb;
    border-radius: 12px;
    padding: 1.25rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    border: 2px solid #e5e7eb;
    transition: all 0.3s ease;
}

.db-stat-item-modern:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.db-stat-icon-modern {
    width: 48px;
    height: 48px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    flex-shrink: 0;
}

.db-stat-icon-file {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
}

.db-stat-icon-size {
    background: linear-gradient(135deg, #10b981, #059669);
}

.db-stat-icon-time {
    background: linear-gradient(135deg, #f59e0b, #d97706);
}

.db-stat-content-modern {
    flex: 1;
}

.db-stat-label-modern {
    font-size: 0.75rem;
    color: #6b7280;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.25rem;
}

.db-stat-value-modern {
    font-size: 1.125rem;
    font-weight: 700;
    color: #1f2937;
}

.db-download-action {
    display: flex;
    justify-content: center;
    margin-top: 1rem;
}

/* Tables */
.db-table-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

.db-table-modern {
    width: 100%;
    border-collapse: collapse;
}

.db-table-modern th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: #374151;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 2px solid #e5e7eb;
    background: #f9fafb;
}

.db-table-row {
    border-bottom: 1px solid #f3f4f6;
    transition: background 0.2s ease;
}

.db-table-row:hover {
    background: #f9fafb;
}

.db-table-modern td {
    padding: 1rem;
    color: #1f2937;
}

.db-file-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.db-file-icon {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.1));
    color: #3b82f6;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.125rem;
    flex-shrink: 0;
}

.db-file-name {
    font-weight: 600;
    color: #1f2937;
}

.db-table-date {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #6b7280;
    font-size: 0.875rem;
}

.db-user-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.db-user-avatar {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
    font-weight: 700;
    flex-shrink: 0;
}

.db-user-name {
    font-weight: 600;
    color: #1f2937;
}

.db-code-modern {
    font-family: 'JetBrains Mono', 'Courier New', monospace;
    font-size: 0.75rem;
    background: #f3f4f6;
    padding: 0.375rem 0.75rem;
    border-radius: 6px;
    color: #1f2937;
    border: 1px solid #e5e7eb;
}

.db-user-agent {
    color: #6b7280;
    font-size: 0.875rem;
    max-width: 300px;
}

.db-text-truncate {
    display: block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* Badges */
.db-badge-modern {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.375rem 0.75rem;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 600;
}

.db-badge-primary {
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
}

.db-badge-success {
    background: rgba(16, 185, 129, 0.1);
    color: #059669;
}

.db-badge-info {
    background: rgba(59, 130, 246, 0.1);
    color: #2563eb;
}

/* Buttons */
.db-btn-modern {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    font-size: 0.875rem;
}

.db-btn-primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
}

.db-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.db-btn-success {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
}

.db-btn-success:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
}

.db-btn-outline {
    background: white;
    color: #374151;
    border: 2px solid #e5e7eb;
}

.db-btn-outline:hover {
    background: #f3f4f6;
    border-color: #d1d5db;
}

.db-btn-action-small {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f3f4f6;
    color: #374151;
    border: none;
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: pointer;
}

.db-btn-action-small:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.db-btn-view:hover {
    background: #3b82f6;
    color: white;
}

.db-btn-restore:hover {
    background: #f59e0b;
    color: white;
}

.db-btn-delete:hover {
    background: #ef4444;
    color: white;
}

/* Actions */
.db-actions-modern {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    align-items: center;
}

/* Pagination */
.db-pagination-modern {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 2px solid #f3f4f6;
}

.db-pagination-info {
    font-size: 0.875rem;
    color: #6b7280;
}

.db-pagination-btns {
    display: flex;
    gap: 0.5rem;
}

.db-btn-pagination {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1.25rem;
    background: white;
    color: #374151;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.3s ease;
    font-size: 0.875rem;
    font-weight: 600;
}

.db-btn-pagination:hover:not(.db-disabled) {
    background: #f3f4f6;
    border-color: #667eea;
    color: #667eea;
}

.db-disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
}

/* Empty States */
.db-empty-state-large {
    text-align: center;
    padding: 4rem 2rem;
}

.db-empty-state-large i {
    font-size: 4rem;
    color: #667eea;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.db-empty-state-large h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1f2937;
    margin: 0 0 0.5rem 0;
}

.db-empty-state-large p {
    font-size: 1rem;
    color: #6b7280;
    margin: 0;
}

/* Utilities */
.text-center {
    text-align: center;
}

.text-right {
    text-align: right;
}

/* Responsive */
@media (max-width: 1024px) {
    .db-charts-grid,
    .db-stats-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .db-container {
        padding: 1rem;
    }

    .db-hero {
        padding: 2rem 1.5rem;
    }

    .db-title {
        font-size: 2rem;
    }

    .db-hero-actions {
        width: 100%;
    }

    .db-hero-actions .btn-action {
        flex: 1;
        justify-content: center;
    }

    .db-card-header-modern {
        flex-direction: column;
        align-items: flex-start;
    }

    .db-table-wrapper {
        overflow-x: scroll;
    }

    .db-pagination-modern {
        flex-direction: column;
        gap: 1rem;
    }
}

/* Dark Mode */
[data-theme="dark"] .db-card-modern,
[data-theme="dark"] .db-stat-item-modern,
[data-theme="dark"] .db-chart-card {
    background: #1f2937;
    border-color: #374151;
}

[data-theme="dark"] .db-card-title,
[data-theme="dark"] .db-stat-value-modern,
[data-theme="dark"] .db-file-name,
[data-theme="dark"] .db-user-name {
    color: #f9fafb;
}

[data-theme="dark"] .db-card-footer-modern,
[data-theme="dark"] .db-stat-label-modern,
[data-theme="dark"] .db-table-date,
[data-theme="dark"] .db-user-agent {
    color: #9ca3af;
}

[data-theme="dark"] .db-table-modern th {
    background: #374151;
}

[data-theme="dark"] .db-table-row:hover {
    background: #374151;
}

[data-theme="dark"] .db-code-modern {
    background: #374151;
    border-color: #4b5563;
    color: #f9fafb;
}
</style>
{% endblock %}
