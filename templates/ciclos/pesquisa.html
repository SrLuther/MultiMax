{% extends 'base.html' %}
{% block title %}Pesquisa de Ciclos — MultiMax{% endblock %}

{% block content %}
<div class="ciclos-container">
    <div class="ciclos-hero" style="margin-bottom: 1.25rem;">
        <div class="ciclos-hero-content">
            <div>
                <h1 class="ciclos-title">
                    <i class="bi bi-search ciclos-title-icon"></i>
                    Pesquisa de Ciclos
                </h1>
                <p class="ciclos-subtitle">Busque por ciclo semanal (ex.: "Ciclo 1 | Janeiro" ou "Dezembro | Janeiro")</p>
            </div>
            <div class="ciclos-hero-actions">
                <a href="{{ url_for('ciclos.index') }}" class="btn-action btn-action-secondary" style="text-decoration:none;">
                    <i class="bi bi-arrow-left"></i>
                    <span>Voltar</span>
                </a>
            </div>
        </div>
    </div>

    <div class="resumo-geral-card" style="margin-bottom: 1.25rem;">
        <div class="resumo-header">
            <h3 class="resumo-title">
                <i class="bi bi-funnel"></i>
                Filtros
            </h3>
        </div>
        <div style="padding: 1rem;">
            <form method="GET" action="{{ url_for('ciclos.pesquisa') }}" style="display:flex; gap:0.75rem; flex-wrap:wrap; align-items:end;">
                <div style="min-width: 280px; flex: 1;">
                    <label class="form-label-modern" style="display:block; margin-bottom:0.25rem;">Buscar</label>
                    <input type="text" name="q" value="{{ q }}" class="form-input-modern" placeholder="Ex.: Ciclo 1 | Janeiro">
                </div>
                <div style="min-width: 200px;">
                    <label class="form-label-modern" style="display:block; margin-bottom:0.25rem;">Ciclo mensal (opcional)</label>
                    <input type="number" name="ciclo_id" value="{{ filtro_ciclo_id or '' }}" class="form-input-modern" placeholder="Ex.: 12">
                </div>
                <button type="submit" class="btn-action btn-action-primary">
                    <i class="bi bi-search"></i>
                    <span>Pesquisar</span>
                </button>
            </form>
        </div>
    </div>

    {% if semanas and (semanas|length) > 0 %}
        {% for s in semanas %}
        <div class="db-card-modern" style="margin-bottom: 1rem;">
            <div class="db-card-header-modern">
                <h3 class="db-card-title">
                    <i class="bi bi-calendar-week"></i>
                    {{ s.label }} (Ciclo mensal {{ s.ciclo_id }})
                </h3>
                <div class="db-card-badges">
                    <span class="db-badge-modern db-badge-info">{{ s.week_start.strftime('%d/%m/%Y') }} — {{ s.week_end.strftime('%d/%m/%Y') }}</span>
                </div>
            </div>
            <div class="db-card-body-modern">
                <div style="display:grid; gap: 1rem;">
                    <div>
                        <strong>Folgas</strong>
                        {% if s.folgas and (s.folgas|length) > 0 %}
                        <table class="ferias-table-modern" style="margin-top: 0.5rem;">
                            <thead>
                                <tr>
                                    <th>Colaborador</th>
                                    <th>Data</th>
                                    <th>Tipo</th>
                                    <th>Dias</th>
                                    <th>Obs</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for f in s.folgas %}
                                <tr>
                                    <td>{{ f.nome_colaborador }}</td>
                                    <td>{{ f.data_folga.strftime('%d/%m/%Y') }}</td>
                                    <td>{{ 'Folga adicional' if f.tipo == 'adicional' else 'Folga usada' }}</td>
                                    <td>{{ f.dias }}</td>
                                    <td>{{ f.observacao or '-' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <div class="empty-state-small-modern" style="margin-top:0.5rem;">
                            <i class="bi bi-calendar-x"></i>
                            <p>Nenhuma folga registrada</p>
                        </div>
                        {% endif %}
                    </div>

                    <div>
                        <strong>Horas extras</strong>
                        {% if s.horas and (s.horas|length) > 0 %}
                        <table class="ferias-table-modern" style="margin-top: 0.5rem;">
                            <thead>
                                <tr>
                                    <th>Colaborador</th>
                                    <th>Data</th>
                                    <th>Origem</th>
                                    <th>Descrição</th>
                                    <th>Horas</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for h in s.horas %}
                                <tr>
                                    <td>{{ h.nome_colaborador }}</td>
                                    <td>{{ h.data_lancamento.strftime('%d/%m/%Y') }}</td>
                                    <td>{{ h.origem }}</td>
                                    <td>{{ h.descricao or '-' }}</td>
                                    <td>{{ "%.1f"|format(h.valor_horas) }}h</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <div class="empty-state-small-modern" style="margin-top:0.5rem;">
                            <i class="bi bi-clock"></i>
                            <p>Nenhuma hora registrada</p>
                        </div>
                        {% endif %}
                    </div>

                    <div>
                        <strong>Ocorrências</strong>
                        {% if s.ocorrencias and (s.ocorrencias|length) > 0 %}
                        <table class="ferias-table-modern" style="margin-top: 0.5rem;">
                            <thead>
                                <tr>
                                    <th>Colaborador</th>
                                    <th>Data</th>
                                    <th>Tipo</th>
                                    <th>Descrição</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for o in s.ocorrencias %}
                                <tr>
                                    <td>{{ o.nome_colaborador }}</td>
                                    <td>{{ o.data_ocorrencia.strftime('%d/%m/%Y') }}</td>
                                    <td>{{ o.tipo }}</td>
                                    <td>{{ o.descricao or '-' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% else %}
                        <div class="empty-state-small-modern" style="margin-top:0.5rem;">
                            <i class="bi bi-exclamation-circle"></i>
                            <p>Nenhuma ocorrência registrada</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state-large" style="margin-top: 2rem;">
            <i class="bi bi-search"></i>
            <h3>Nenhum ciclo encontrado</h3>
            <p>Tente buscar por "Janeiro", "Ciclo 1", ou "Dezembro | Janeiro".</p>
        </div>
    {% endif %}
</div>
{% endblock %}

