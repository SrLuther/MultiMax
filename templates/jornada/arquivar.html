{% extends 'base.html' %}
{% block title %}Arquivar Jornada — MultiMax{% endblock %}

{% block content %}
<div class="container-fluid" style="max-width: 800px; margin: 2rem auto; padding: 0 1rem;">
    <div class="card shadow-sm">
        <div class="card-header bg-danger text-white">
            <h4 class="mb-0">
                <i class="bi bi-archive"></i>
                Arquivar Dados da Jornada
            </h4>
        </div>
        <div class="card-body">
            <div class="alert alert-warning">
                <i class="bi bi-exclamation-triangle"></i>
                <strong>Atenção!</strong> Esta ação irá:
                <ul class="mb-0 mt-2">
                    <li>Copiar os registros do período/meses selecionados para o arquivo</li>
                    <li><strong>Deletar permanentemente</strong> os registros arquivados</li>
                    <li><strong>NÃO arquivará</strong> registros que compõem Horas Residuais e Saldo de Folgas pendentes</li>
                </ul>
                <strong class="mt-2 d-block">Esta ação não pode ser desfeita!</strong>
                <small class="d-block mt-2">Horas Residuais e Saldo de Folgas sempre serão preservados, pois são valores pendentes.</small>
            </div>

            <form method="POST" action="{{ url_for('jornada.arquivar') }}" id="arquivarForm">
                <div class="mb-4">
                    <label class="form-label fw-bold">
                        <i class="bi bi-calendar-range"></i>
                        Selecionar por Meses (recomendado)
                    </label>
                    <div class="border rounded p-3" style="max-height: 300px; overflow-y: auto;">
                        {% if available_months %}
                        <div class="row g-2">
                            {% for month in available_months %}
                            {% set month_parts = month.split('-') %}
                            {% set year = month_parts[0] | int %}
                            {% set month_num = month_parts[1] | int %}
                            {% set month_names = ['', 'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'] %}
                            <div class="col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="months[]" value="{{ month }}" id="month_{{ month }}">
                                    <label class="form-check-label" for="month_{{ month }}">
                                        {{ month_names[month_num] }}/{{ year }}
                                    </label>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-muted mb-0">Nenhum registro encontrado.</p>
                        {% endif %}
                    </div>
                    <small class="form-text text-muted">Selecione um ou mais meses para arquivar. Os registros de Horas Residuais e Saldo de Folgas serão preservados automaticamente.</small>
                </div>

                <div class="mb-4">
                    <label class="form-label fw-bold">
                        <span class="text-muted">OU</span> selecionar por Período
                    </label>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="period_start" class="form-label">
                            <i class="bi bi-calendar-event"></i>
                            Data de Início do Período
                        </label>
                        <input type="date" 
                               class="form-control" 
                               id="period_start" 
                               name="period_start" 
                               value="{{ suggested_start.strftime('%Y-%m-%d') if suggested_start else '' }}">
                    </div>
                    <div class="col-md-6">
                        <label for="period_end" class="form-label">
                            <i class="bi bi-calendar-event-fill"></i>
                            Data de Fim do Período
                        </label>
                        <input type="date" 
                               class="form-control" 
                               id="period_end" 
                               name="period_end" 
                               value="{{ suggested_end.strftime('%Y-%m-%d') if suggested_end else '' }}">
                    </div>
                </div>

                <div class="mb-3">
                    <label for="description" class="form-label">
                        <i class="bi bi-card-text"></i>
                        Descrição (opcional)
                    </label>
                    <textarea class="form-control" 
                              id="description" 
                              name="description" 
                              rows="3"
                              placeholder="Ex: Arquivo do primeiro semestre de 2024"></textarea>
                </div>

                <div class="d-flex gap-2 justify-content-end">
                    <a href="{{ url_for('jornada.arquivados') }}" class="btn btn-info text-white">
                        <i class="bi bi-archive-fill"></i>
                        Ver Arquivados
                    </a>
                    <a href="{{ url_for('jornada.index') }}" class="btn btn-secondary">
                        <i class="bi bi-x-circle"></i>
                        Cancelar
                    </a>
                    <button type="submit" class="btn btn-danger" onclick="return confirm('Tem certeza que deseja arquivar os dados? Registros de Horas Residuais e Saldo de Folgas serão preservados. Esta ação não pode ser desfeita!');">
                        <i class="bi bi-archive"></i>
                        Arquivar Dados
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

