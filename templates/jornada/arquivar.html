{% extends 'base.html' %}
{% block title %}Arquivar Jornada — MultiMax{% endblock %}

{% block content %}
<div class="jornada-container">
    <div class="jornada-hero">
        <div class="jornada-hero-content">
            <div>
                <h1 class="jornada-title" style="background: var(--jornada-danger); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    <i class="bi bi-archive jornada-title-icon" style="background: var(--jornada-danger); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"></i>
                    Arquivar Dados da Jornada
                </h1>
                <p class="jornada-subtitle">Arquivar registros por período ou meses selecionados</p>
            </div>
            <a href="{{ url_for('jornada.em_aberto') }}" class="btn-jornada btn-jornada-secondary">
                <i class="bi bi-arrow-left"></i>
                <span>Voltar</span>
            </a>
        </div>
    </div>

    <div class="jornada-card" style="background: rgba(250, 112, 154, 0.1); border-color: rgba(250, 112, 154, 0.3);">
        <div style="display: flex; align-items: flex-start; gap: 1rem;">
            <i class="bi bi-exclamation-triangle" style="font-size: 1.5rem; color: #fca5a5; margin-top: 0.25rem;"></i>
            <div style="flex: 1;">
                <strong style="color: var(--jornada-text); display: block; margin-bottom: 0.75rem;">Atenção!</strong> Esta ação irá:
                <ul style="margin: 0.75rem 0; padding-left: 1.5rem; color: var(--jornada-text);">
                    <li>Copiar os registros do período/meses selecionados para o arquivo</li>
                    <li><strong>Deletar permanentemente</strong> os registros arquivados</li>
                    <li><strong>NÃO arquivará</strong> registros que compõem Horas Residuais e Saldo de Folgas pendentes</li>
                </ul>
                <strong style="color: var(--jornada-text); display: block; margin-top: 1rem;">Esta ação não pode ser desfeita!</strong>
                <small style="color: var(--jornada-text-muted); display: block; margin-top: 0.5rem;">Horas Residuais e Saldo de Folgas sempre serão preservados, pois são valores pendentes.</small>
            </div>
        </div>
    </div>

    <div class="jornada-card">
        <form method="POST" action="{{ url_for('jornada.arquivar') }}" id="arquivarForm">
            <div class="jornada-form-group" style="grid-column: 1 / -1;">
                <label class="jornada-form-label">
                    <i class="bi bi-calendar-range"></i>
                    Selecionar por Meses (recomendado)
                </label>
                <div style="background: rgba(255, 255, 255, 0.03); border: 1px solid var(--jornada-border); border-radius: 12px; padding: 1.5rem; max-height: 300px; overflow-y: auto;">
                    {% if available_months %}
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
                        {% for month in available_months %}
                        {% set month_parts = month.split('-') %}
                        {% set year = month_parts[0] | int %}
                        {% set month_num = month_parts[1] | int %}
                        {% set month_names = ['', 'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'] %}
                        <label style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(255, 255, 255, 0.03); border: 1px solid var(--jornada-border); border-radius: 8px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='rgba(102, 126, 234, 0.1)'; this.style.borderColor='rgba(102, 126, 234, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.03)'; this.style.borderColor='var(--jornada-border)'">
                            <input type="checkbox" name="months[]" value="{{ month }}" id="month_{{ month }}" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="color: var(--jornada-text);">{{ month_names[month_num] }}/{{ year }}</span>
                        </label>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p style="color: var(--jornada-text-muted); margin: 0;">Nenhum registro encontrado.</p>
                    {% endif %}
                </div>
                <small style="color: var(--jornada-text-muted); font-size: 0.75rem; margin-top: 0.5rem; display: block;">Selecione um ou mais meses para arquivar. Os registros de Horas Residuais e Saldo de Folgas serão preservados automaticamente.</small>
            </div>

            <div style="grid-column: 1 / -1; margin: 2rem 0 1rem 0; text-align: center; position: relative;">
                <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: var(--jornada-border);"></div>
                <span style="background: var(--jornada-bg); padding: 0 1rem; color: var(--jornada-text-muted); position: relative;">OU</span>
            </div>

            <div class="jornada-form-group">
                <label class="jornada-form-label" for="period_start">
                    <i class="bi bi-calendar-event"></i>
                    Data de Início do Período
                </label>
                <input type="date" 
                       class="jornada-form-input" 
                       id="period_start" 
                       name="period_start" 
                       value="{{ suggested_start.strftime('%Y-%m-%d') if suggested_start else '' }}">
            </div>
            <div class="jornada-form-group">
                <label class="jornada-form-label" for="period_end">
                    <i class="bi bi-calendar-event-fill"></i>
                    Data de Fim do Período
                </label>
                <input type="date" 
                       class="jornada-form-input" 
                       id="period_end" 
                       name="period_end" 
                       value="{{ suggested_end.strftime('%Y-%m-%d') if suggested_end else '' }}">
            </div>
            <div class="jornada-form-group" style="grid-column: 1 / -1;">
                <label class="jornada-form-label" for="description">
                    <i class="bi bi-card-text"></i>
                    Descrição (opcional)
                </label>
                <textarea class="jornada-form-input" 
                          id="description" 
                          name="description" 
                          rows="3"
                          placeholder="Ex: Arquivo do primeiro semestre de 2024"
                          style="resize: vertical;"></textarea>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--jornada-border);">
                <a href="{{ url_for('jornada.arquivados') }}" class="btn-jornada btn-jornada-info">
                    <i class="bi bi-archive-fill"></i>
                    Ver Arquivados
                </a>
                <a href="{{ url_for('jornada.index') }}" class="btn-jornada btn-jornada-secondary">
                    <i class="bi bi-x-circle"></i>
                    Cancelar
                </a>
                <button type="submit" class="btn-jornada btn-jornada-danger" onclick="return confirm('Tem certeza que deseja arquivar os dados? Registros de Horas Residuais e Saldo de Folgas serão preservados. Esta ação não pode ser desfeita!');">
                    <i class="bi bi-archive"></i>
                    Arquivar Dados
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

