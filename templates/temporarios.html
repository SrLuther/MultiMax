{% extends 'base.html' %}
{% block title %}Dados Temporários — MultiMax{% endblock %}

{% block breadcrumb %}
<span class="mm-breadcrumb-separator">/</span>
<span>Dados Temporários</span>
{% endblock %}

{% block content %}
<div class="mm-page-header mm-flex mm-items-center mm-justify-between mm-mb-6">
    <div>
        <h1 class="mm-page-title">Dados Temporários</h1>
        <p class="mm-text-muted">Revisão, ajustes e aprovação antes de aplicar ao banco definitivo</p>
    </div>
</div>

<form method="get" class="mm-flex mm-gap-2 mm-items-center">
    <select name="tipo" class="mm-input" style="min-width: 160px;">
        <option value="">Todos os tipos</option>
        <option value="folga_credit" {% if tipo=='folga_credit' %}selected{% endif %}>Crédito de Folga</option>
        <option value="hour_bank" {% if tipo=='hour_bank' %}selected{% endif %}>Banco de Horas</option>
    </select>
    <select name="status" class="mm-input" style="min-width: 160px;">
        <option value="pendente" {% if status=='pendente' %}selected{% endif %}>Pendentes</option>
        <option value="aprovado" {% if status=='aprovado' %}selected{% endif %}>Aprovados</option>
        <option value="rejeitado" {% if status=='rejeitado' %}selected{% endif %}>Rejeitados</option>
    </select>
    <button type="submit" class="mm-btn mm-btn-outline"><i class="bi bi-funnel"></i> Filtrar</button>
</form>

<div class="mm-card">
    <div class="mm-card-header">
        <h3 class="mm-card-title">
            <i class="bi bi-hourglass-split mm-text-primary"></i>
            Itens {{ status|capitalize }}
        </h3>
    </div>
    <div class="mm-card-body">
        <div class="mm-table-responsive">
            <table class="mm-table">
                <thead>
                    <tr>
                        <th>Colaborador</th>
                        <th>Tipo</th>
                        <th>Data</th>
                        <th>Dias</th>
                        <th>Horas</th>
                        <th>Motivo</th>
                        <th style="width: 220px;">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for it in items %}
                    <tr>
                        <form method="post" action="{{ url_for('temporarios.update') }}">
                            <input type="hidden" name="id" value="{{ it.id }}" />
                            <td>
                                <select name="collaborator_id" class="mm-input" style="min-width:220px;">
                                    {% for c in collab_list %}
                                    <option value="{{ c.id }}" {% if c.id == it.collaborator_id %}selected{% endif %}>{{ c.name }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <select name="kind" class="mm-input" style="min-width:220px;">
                                    <option value="folga_credit" {% if it.kind=='folga_credit' %}selected{% endif %}>Crédito de Folga</option>
                                    <option value="hour_bank" {% if it.kind=='hour_bank' %}selected{% endif %}>Crédito de Hora</option>
                                    <option value="folga_hour_both" {% if it.kind=='folga_hour_both' %}selected{% endif %}>Crédito Folga e Hora</option>
                                </select>
                            </td>
                            <td><input type="date" name="date" value="{{ it.date.strftime('%Y-%m-%d') }}" class="mm-input" /></td>
                            <td><input type="number" name="amount_days" value="{{ it.amount_days or '' }}" class="mm-input" min="0" /></td>
                            <td><input type="number" step="0.5" name="hours" value="{{ it.hours or '' }}" class="mm-input" min="0" /></td>
                            <td><input type="text" name="reason" value="{{ it.reason or '' }}" class="mm-input" /></td>
                            <input type="hidden" name="source" value="{{ it.source or '' }}" />
                            <td class="mm-flex mm-gap-2">
                                <button type="submit" name="action" value="update" class="mm-btn mm-btn-outline"><i class="bi bi-pencil"></i> Ajustar</button>
                                {% if it.status == 'pendente' %}
                                <button type="submit" name="action" value="approve" class="mm-btn mm-btn-primary"><i class="bi bi-check2-circle"></i> Aprovar</button>
                                <button type="submit" name="action" value="reject" class="mm-btn mm-btn-danger" onclick="return confirm('Rejeitar este item?');"><i class="bi bi-x-circle"></i> Rejeitar</button>
                                {% endif %}
                            </td>
                        </form>
                    </tr>
                    {% else %}
                    <tr><td colspan="8" class="mm-text-muted">Nenhum item encontrado.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}
